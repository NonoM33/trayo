<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SÃ©lection des Bots - Trayo</title>
  <%= stylesheet_link_tag "onboarding", "data-turbo-track": "reload" %>
</head>
<body class="onboarding-slides">
  <div class="slides-container">
    <div class="step-indicator" style="max-width: 700px; margin: 0 auto 40px;">
      <div class="step completed">âœ“</div>
      <div class="step completed">âœ“</div>
      <div class="step active">3</div>
      <div class="step">4</div>
    </div>
    
    <div class="modern-header" style="max-width: 800px; margin: 0 auto 40px; text-align: center;">
      <% budget = @invitation.budget || 0 %>
      <div style="margin-bottom: 16px;">
        <div style="font-size: 13px; color: rgba(255, 255, 255, 0.5); font-weight: 500; letter-spacing: 1px; text-transform: uppercase; margin-bottom: 8px;">Choisissez vos bots</div>
        <h2 style="font-size: 48px; font-weight: 700; color: white; margin: 0; letter-spacing: -1px; margin-bottom: 24px;">SÃ©lectionnez vos stratÃ©gies</h2>
      </div>
      <div style="display: inline-flex; align-items: center; gap: 12px; background: rgba(255, 255, 255, 0.08); padding: 16px 28px; border-radius: 32px; border: 1px solid rgba(255, 255, 255, 0.1);">
        <span style="font-size: 14px; color: rgba(255, 255, 255, 0.6); font-weight: 500;">Budget d'investissement</span>
        <span style="font-size: 28px; font-weight: 700; color: #60a5fa; letter-spacing: -0.5px;"><%= number_to_currency(budget, unit: "â‚¬", format: "%n %u") %></span>
      </div>
    </div>
    
    <div class="modern-cards-container" style="max-width: 800px; margin: 0 auto 40px;">
      <% @trading_bots.each do |bot| %>
        <% 
          bot_price = bot.price
          budget_multiplier = budget > 0 ? (budget / 10000.0) : 1
          monthly_min_proj = ((bot.calculate_real_projections[:monthly_min] || 0) * budget_multiplier).round(2)
          monthly_max_proj = ((bot.calculate_real_projections[:monthly_max] || 0) * budget_multiplier).round(2)
          yearly_proj = ((bot.calculate_real_projections[:yearly] || 0) * budget_multiplier).round(2)
        %>
        <div class="modern-card" data-bot-id="<%= bot.id %>">
          <div class="modern-card-content">
            <div class="modern-card-header">
              <div class="modern-card-icon">ðŸ¤–</div>
              <h3 class="modern-card-title"><%= bot.name %></h3>
              <div class="modern-checkbox-circle">
                <div class="modern-checkbox-inner"></div>
              </div>
            </div>
            
            <div class="modern-price-section">
              <span class="modern-price-label">Investissement</span>
              <div class="modern-price-amount"><%= number_to_currency(bot_price, unit: "â‚¬", format: "%n %u") %></div>
            </div>
            
            <div class="modern-projections">
              <div class="modern-projection-row">
                <div class="modern-projection-label">
                  <span class="modern-projection-icon">ðŸ“ˆ</span>
                  <span>Mensuel</span>
                </div>
                <div class="modern-projection-value">
                  <%= number_to_currency(monthly_min_proj, unit: "â‚¬", format: "%n %u") %> - <%= number_to_currency(monthly_max_proj, unit: "â‚¬", format: "%n %u") %>
                </div>
              </div>
              <div class="modern-projection-row highlight">
                <div class="modern-projection-label">
                  <span class="modern-projection-icon">ðŸ’°</span>
                  <span>Annuel</span>
                </div>
                <div class="modern-projection-value highlight-value">
                  <%= number_to_currency(yearly_proj, unit: "â‚¬", format: "%n %u") %>
                </div>
              </div>
            </div>
          </div>
        </div>
      <% end %>
    </div>
    
    <%= form_with url: onboarding_next_step_path(@invitation.code), method: :post, local: true, id: "botsForm" do |f| %>
      <div class="bots-grid" style="display: none;">
        <% @trading_bots.each do |bot| %>
          <%= check_box_tag "selected_bots[]", bot.id, false, id: "bot_#{bot.id}" %>
        <% end %>
      </div>
        
      <div style="max-width: 700px; margin: 0 auto;">
        <%= f.submit "Passer au rÃ¨glement", class: "btn-primary modern-submit-btn", id: "submitBtn", disabled: true %>
      </div>
    <% end %>
  
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const modernCards = document.querySelectorAll('.modern-card');
      
      modernCards.forEach(card => {
        card.addEventListener('click', function(event) {
          event.preventDefault();
          
          const isSelected = this.classList.contains('selected');
          this.classList.toggle('selected');
          
          const botId = this.dataset.botId;
          const checkbox = document.querySelector(`#bot_${botId}`);
          
          if (checkbox) {
            checkbox.checked = !checkbox.checked;
          }
          
          updateSubmitButton();
          
          const priceLabel = this.querySelector('.modern-price-amount');
          if (priceLabel && !isSelected) {
            priceLabel.style.transform = 'scale(1.1)';
            setTimeout(() => {
              priceLabel.style.transform = 'scale(1)';
            }, 200);
          }
        });
      });
      
      function updateSubmitButton() {
        const checkedBoxes = document.querySelectorAll('input[type="checkbox"]:checked');
        const submitBtn = document.getElementById('submitBtn');
        
        if (checkedBoxes.length > 0) {
          submitBtn.disabled = false;
          submitBtn.style.opacity = '1';
          submitBtn.style.cursor = 'pointer';
          submitBtn.textContent = `Passer au rÃ¨glement (${checkedBoxes.length})`;
        } else {
          submitBtn.disabled = true;
          submitBtn.style.opacity = '0.5';
          submitBtn.style.cursor = 'not-allowed';
          submitBtn.textContent = 'Passer au rÃ¨glement';
        }
      }
      
      updateSubmitButton();
    });
  </script>
</body>
</html>

