<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Choisir un Broker - Trayo</title>
  <%= stylesheet_link_tag "onboarding", "data-turbo-track": "reload" %>
</head>
<body class="onboarding-page">
  <div class="onboarding-container">
    <div class="step-indicator">
      <div class="step completed">✓</div>
      <div class="step active">2</div>
      <div class="step">3</div>
      <div class="step">4</div>
    </div>
    
    <div class="onboarding-card">
      <h2>Choisissez votre Broker</h2>
      <p class="subtitle">Sélectionnez un broker partenaire et créez votre compte. Ensuite, rentrez vos identifiants pour que les bots puissent travailler.</p>
      
      <%= form_with url: onboarding_next_step_path(@invitation.code), method: :post, local: true do |f| %>
        <div class="broker-options" id="broker-options">
          <% @brokers.each_with_index do |broker, index| %>
            <div class="broker-option" data-broker="<%= broker[:name] %>" data-link="<%= broker[:affiliate_link] %>">
              <div class="header">
                <div class="logo"><%= broker[:logo] %></div>
                <div class="info">
                  <h3><%= broker[:name] %></h3>
                  <p><%= broker[:description] %></p>
                </div>
              </div>
              <div class="advantages">
                <% broker[:advantages].each do |advantage| %>
                  <span class="tag"><%= advantage %></span>
                <% end %>
              </div>
              <%= f.hidden_field :broker_name, value: broker[:name], id: "broker_name_#{index}" %>
              <%= f.hidden_field :affiliate_link, value: broker[:affiliate_link], id: "affiliate_link_#{index}" %>
            </div>
          <% end %>
        </div>
        
        <div class="broker-credentials">
          <h3>Identifiants de votre compte</h3>
          
          <div class="form-group">
            <%= f.label :account_id, "ID du compte MT5" %>
            <%= f.text_field :account_id, required: true, placeholder: "12345678" %>
          </div>
          
          <div class="form-group">
            <%= f.label :account_password, "Mot de passe du compte MT5" %>
            <%= f.password_field :account_password, required: true, placeholder: "Votre mot de passe trader" %>
          </div>
        </div>
        
        <p style="font-size: 14px; color: #64748b; margin-bottom: 24px;">
          <strong>Note :</strong> C'est le mot de passe de votre compte MetaTrader 5, pas celui de votre compte client. 
          Vous le trouverez dans MT5 : Outils → Options → Serveur → Détails → Mot de passe trader.
        </p>
        
        <%= f.submit "Continuer", class: "btn-primary" %>
      <% end %>
    </div>
  </div>
  
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const brokerOptions = document.querySelectorAll('.broker-option');
      
      brokerOptions.forEach(option => {
        option.addEventListener('click', function() {
          brokerOptions.forEach(opt => opt.classList.remove('selected'));
          this.classList.add('selected');
          
          const brokerNameInput = this.querySelector('[name="broker_name"]');
          const affiliateLinkInput = this.querySelector('[name="affiliate_link"]');
          
          document.querySelectorAll('[name="broker_name"]').forEach(input => {
            if (input !== brokerNameInput) {
              input.disabled = true;
            }
          });
          
          document.querySelectorAll('[name="affiliate_link"]').forEach(input => {
            if (input !== affiliateLinkInput) {
              input.disabled = true;
            }
          });
        });
      });
    });
  </script>
</body>
</html>

