<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RÃ¨glement - Trayo</title>
  <%= stylesheet_link_tag "onboarding", "data-turbo-track": "reload" %>
</head>
<body class="onboarding-slides">
  <div class="slides-container">
    <div class="step-indicator" style="max-width: 700px; margin: 0 auto 40px;">
      <div class="step completed">âœ“</div>
      <div class="step completed">âœ“</div>
      <div class="step completed">âœ“</div>
      <div class="step active">4</div>
    </div>
    
    <div class="payment-card">
      <h2>Votre rÃ¨glement</h2>
      <p class="payment-subtitle">VÃ©rifiez les dÃ©tails et procÃ©dez au paiement</p>
      
      <% 
        selected_bot_ids = @invitation.selected_bots_parsed
        selected_bots = TradingBot.where(id: selected_bot_ids)
        total_bots_price = selected_bots.sum(&:price)
        vps_yearly_price = 399.99
        total_price = total_bots_price + vps_yearly_price
      %>
      
      <div class="payment-items">
        <div class="payment-item first">
          <div class="payment-item-icon">ðŸ’¾</div>
          <div class="payment-item-info">
            <span class="payment-item-name">VPS (12 mois)</span>
            <span class="payment-item-desc">Serveur virtuel dÃ©diÃ©</span>
          </div>
          <div class="payment-item-price"><%= number_to_currency(vps_yearly_price, unit: "â‚¬", format: "%n %u") %></div>
        </div>
        
        <% selected_bots.each do |bot| %>
          <div class="payment-item">
            <div class="payment-item-icon">ðŸ¤–</div>
            <div class="payment-item-info">
              <span class="payment-item-name"><%= bot.name %></span>
              <span class="payment-item-desc">Bot de trading</span>
            </div>
            <div class="payment-item-price"><%= number_to_currency(bot.price, unit: "â‚¬", format: "%n %u") %></div>
          </div>
        <% end %>
        
        <div class="payment-item total">
          <div class="payment-item-info">
            <span class="payment-item-name">Total</span>
          </div>
          <div class="payment-item-price"><%= number_to_currency(total_price, unit: "â‚¬", format: "%n %u") %></div>
        </div>
      </div>
      
      <div class="payment-terms">
        En cliquant sur "Finaliser", vous acceptez les rÃ¨gles et vous engagez Ã  rÃ©gler les commissions toutes les 2 semaines.
      </div>
      
      <%= form_with url: onboarding_next_step_path(@invitation.code), method: :post, local: true do |f| %>
        <%= f.submit "Finaliser ma commande", class: "btn-primary" %>
      <% end %>
    </div>
  </div>
</body>
</html>

