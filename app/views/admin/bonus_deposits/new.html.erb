<!DOCTYPE html>
<html>
<head>
  <title>Nouveau D√©p√¥t Bonus - Trayo</title>
  <%= stylesheet_link_tag "admin" %>
</head>
<body>
  <% @page_title = "Nouveau D√©p√¥t Bonus" %>
  
  <div class="app-layout">
    <%= render 'admin/shared/sidebar' %>
    
    <div class="main-content">
      <%= render 'admin/shared/navbar' %>
      
      <div class="container" style="max-width: 800px;">
        <%= link_to "‚Üê Retour au Programme Bonus", admin_bonus_deposits_path, class: "back-link" %>
        
        <div class="card">
          <h2>üí∞ Faire un D√©p√¥t Bonus</h2>
          
          <% if @current_period && @current_bonus_rate && @current_bonus_rate > 0 %>
            <div class="info-box info-box-success" style="margin-bottom: 24px;">
              <div class="info-box-title">üéâ Bonus Actuel : <%= number_to_percentage(@current_bonus_rate, precision: 1) %></div>
              <p style="margin: 8px 0 0 0;">
                <strong><%= @current_period.name %></strong><br>
                Valide jusqu'au <%= l(@current_period.end_date, format: :long) %>. D√©posez maintenant pour obtenir un bonus instantan√© de <%= number_to_percentage(@current_bonus_rate, precision: 1) %> !
              </p>
            </div>
          <% else %>
            <div class="info-box info-box-warning" style="margin-bottom: 24px;">
              <div class="info-box-title">‚ö†Ô∏è Aucune P√©riode de Bonus Active</div>
              <p style="margin: 8px 0 0 0;">
                Il n'y a actuellement aucune p√©riode de bonus active. Votre d√©p√¥t sera trait√© sans bonus.
              </p>
            </div>
          <% end %>
          
          <%= form_with model: @bonus_deposit, url: admin_bonus_deposits_path, method: :post, local: true do |f| %>
            <% if @bonus_deposit.errors.any? %>
              <div class="error-messages">
                <h3>Erreurs :</h3>
                <ul>
                  <% @bonus_deposit.errors.full_messages.each do |message| %>
                    <li><%= message %></li>
                  <% end %>
                </ul>
              </div>
            <% end %>
            
            <div class="form-group">
              <%= f.label :amount, "Montant du D√©p√¥t (‚Ç¨)" %>
              <%= f.number_field :amount, step: 0.01, min: 100, required: true, placeholder: "1000.00" %>
              <div class="help-text">D√©p√¥t minimum : 100 ‚Ç¨</div>
            </div>
            
            <div style="background: var(--bg-hover); padding: 20px; border-radius: 8px; margin: 24px 0;">
              <h3 style="margin: 0 0 16px 0; font-size: 16px;">Aper√ßu du Calcul</h3>
              <div style="display: grid; gap: 12px;">
                <div style="display: flex; justify-content: space-between;">
                  <span>Votre d√©p√¥t :</span>
                  <strong id="depositAmount">0,00 ‚Ç¨</strong>
                </div>
                <div style="display: flex; justify-content: space-between; color: var(--color-success);">
                  <span>Bonus (<%= number_to_percentage(@current_bonus_rate || 0, precision: 1) %>) :</span>
                  <strong id="bonusAmount">0,00 ‚Ç¨</strong>
                </div>
                <div style="border-top: 2px solid var(--border-color); padding-top: 12px; display: flex; justify-content: space-between; font-size: 18px;">
                  <span>Total cr√©dits que vous recevrez :</span>
                  <strong style="color: var(--color-accent);" id="totalCredit">0,00 ‚Ç¨</strong>
                </div>
              </div>
            </div>
            
            <div class="form-group">
              <%= f.label :notes, "Notes (optionnel)" %>
              <%= f.text_area :notes, rows: 3, placeholder: "Informations suppl√©mentaires..." %>
            </div>
            
            <div class="info-box info-box-warning">
              <div class="info-box-title">‚ö†Ô∏è Important</div>
              <p style="margin: 8px 0 0 0;">
                Votre d√©p√¥t restera en attente jusqu'√† validation par un administrateur. 
                Une fois valid√©, le total des cr√©dits (d√©p√¥t + bonus) sera ajout√© √† votre compte.
              </p>
            </div>
            
            <%= f.submit "Soumettre la Demande de D√©p√¥t Bonus", class: "btn btn-success", style: "margin-top: 24px;" %>
          <% end %>
        </div>
      </div>
    </div>
  </div>
  
  <script>
    const amountInput = document.querySelector('input[name="bonus_deposit[amount]"]');
    const bonusRate = <%= @current_bonus_rate || 0 %>;
    
    function formatEuro(amount) {
      return amount.toFixed(2).replace('.', ',').replace(/\B(?=(\d{3})+(?!\d))/g, ' ') + ' ‚Ç¨';
    }
    
    function updateCalculation() {
      const amount = parseFloat(amountInput.value) || 0;
      const bonus = amount * (bonusRate / 100);
      const total = amount + bonus;
      
      document.getElementById('depositAmount').textContent = formatEuro(amount);
      document.getElementById('bonusAmount').textContent = formatEuro(bonus);
      document.getElementById('totalCredit').textContent = formatEuro(total);
    }
    
    amountInput.addEventListener('input', updateCalculation);
    updateCalculation();
  </script>
</body>
</html>

