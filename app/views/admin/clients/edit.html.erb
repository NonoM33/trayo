<!DOCTYPE html>
<html>
<head>
  <title>Modifier Utilisateur - Admin Trayo</title>
  <%= stylesheet_link_tag "admin" %>
</head>
<body>
  <% @page_title = "Modifier le Profil Utilisateur" %>
  
  <div class="app-layout">
    <%= render 'admin/shared/sidebar' %>
    
    <div class="main-content">
      <%= render 'admin/shared/navbar' %>
      
      <div class="container" style="max-width: 900px;">
        <%= link_to "<i class='fa-icon fa-md fa-arrow-left'></i> Retour au Client".html_safe, admin_client_path(@client), class: "back-link" %>
        
        <% if flash[:notice] %>
          <div class="notice"><%= flash[:notice] %></div>
        <% end %>
        <% if flash[:alert] %>
          <div class="alert"><%= flash[:alert] %></div>
        <% end %>
        
        <div class="card">
          <h2><i class="fa-icon fa-md fa-user"></i> Informations Utilisateur</h2>
          
          <%= form_with model: @client, url: admin_client_path(@client), method: :patch, local: true do |f| %>
            <div class="two-col">
              <div class="form-group">
                <%= f.label :first_name, "First Name" %>
                <%= f.text_field :first_name, placeholder: "John" %>
              </div>
              
              <div class="form-group">
                <%= f.label :last_name, "Last Name" %>
                <%= f.text_field :last_name, placeholder: "Doe" %>
              </div>
            </div>
            
            <div class="two-col">
              <div class="form-group">
                <%= f.label :email, "Email Address" %>
                <%= f.email_field :email, required: true, placeholder: "user@example.com" %>
                <div class="help-text"><i class="fa-icon fa-md fa-exclamation-triangle"></i> Changing email will require the user to login with the new email</div>
              </div>
              
              <div class="form-group">
                <%= f.label :phone, "Phone Number" %>
                <%= f.text_field :phone, placeholder: "+33 6 12 34 56 78" %>
              </div>
            </div>
            
            <div class="form-group">
              <%= f.label :commission_rate, "Commission Rate (%)" %>
              <%= f.number_field :commission_rate, step: 0.1, min: 0, max: 100 %>
              <div class="help-text">Current: <%= number_to_percentage(@client.commission_rate, precision: 1) %></div>
            </div>
            
            <div class="form-group">
              <label>
                <%= f.check_box :is_admin %>
                Administrator Account
              </label>
              <div class="help-text"><i class="fa-icon fa-md fa-exclamation-triangle"></i> Admin users have full access to the back office</div>
            </div>
            
            <%= f.submit "üíæ Sauvegarder les Modifications", class: "btn btn-success" %>
          <% end %>
        </div>
        
        <div class="card">
          <h2>üîê Password Management</h2>
          
          <%= form_with url: reset_password_admin_client_path(@client), method: :post, local: true do |f| %>
            <div class="info-box info-box-warning" style="margin-bottom: 20px;">
              <div class="info-box-title"><i class="fa-icon fa-md fa-exclamation-triangle"></i> Password Reset</div>
              <p style="margin: 0;">A new temporary password will be generated and sent to the user's email address.</p>
            </div>
            
            <div class="form-group">
              <%= f.label :new_password, "Or set a custom password" %>
              <%= f.password_field :new_password, placeholder: "Leave empty for auto-generated password" %>
              <div class="help-text">Must be at least 6 characters. If empty, a random password will be generated.</div>
            </div>
            
            <div class="form-group">
              <label>
                <%= f.check_box :send_email, checked: true %>
                Send password reset email to user
              </label>
            </div>
            
            <%= f.submit "üîÑ Reset Password", class: "btn btn-warning", data: { confirm: "Are you sure you want to reset this user's password?" } %>
          <% end %>
        </div>
        
        <div class="card">
          <h2>üîë API Token</h2>
          
          <div class="info-box info-box-info">
            <div class="info-box-title">MT5 API Token</div>
            <div style="font-family: monospace; font-size: 13px; word-break: break-all; margin: 10px 0;">
              <%= @client.mt5_api_token || "Not generated yet" %>
            </div>
          </div>
          
          <%= form_with url: regenerate_token_admin_client_path(@client), method: :post, local: true do |f| %>
            <%= f.submit "üîÑ Regenerate API Token", class: "btn btn-primary", data: { confirm: "This will invalidate the current token. The MT5 script will need to be updated. Continue?" } %>
          <% end %>
        </div>
        
        <div class="card">
          <h2><i class="fa-icon fa-md fa-trash"></i> Danger Zone</h2>
          
          <div class="info-box-warning" style="margin-bottom: 20px;">
            <div class="info-box-title"><i class="fa-icon fa-md fa-exclamation-triangle"></i> Supprimer le Compte Utilisateur</div>
            <p style="margin: 0;">Cette action ne peut pas √™tre annul√©e. Tous les comptes MT5 associ√©s, trades, paiements et cr√©dits seront d√©finitivement supprim√©s.</p>
          </div>
          
          <%= button_to "<i class='fa-icon fa-md fa-trash'></i> Supprimer le Compte Utilisateur".html_safe, admin_client_path(@client), method: :delete, class: "btn btn-danger", data: { confirm: "√ätes-vous ABSOLUMENT s√ªr ? Tapez SUPPRIMER pour confirmer.\n\nCela supprimera d√©finitivement :\n- Le compte utilisateur\n- Tous les comptes MT5\n- Tous les trades\n- Tous les paiements\n- Tous les cr√©dits\n\nCette action NE PEUT PAS √™tre annul√©e !" } %>
        </div>
      </div>
    </div>
  </div>
</body>
</html>

