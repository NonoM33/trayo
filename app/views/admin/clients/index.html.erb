<!DOCTYPE html>
<html>
<head>
  <title>Clients - Admin Trayo</title>
  <%= stylesheet_link_tag "admin" %>
</head>
<body>
  <% @page_title = "Clients Management" %>
  
  <div class="app-layout">
    <%= render 'admin/shared/sidebar' %>
    
    <div class="main-content">
      <%= render 'admin/shared/navbar' %>
      
      <div class="container">
    <% if flash[:notice] %>
      <div class="notice"><%= flash[:notice] %></div>
    <% end %>
    <% if flash[:alert] %>
      <div class="alert" style="background: #f44336;"><%= flash[:alert] %></div>
    <% end %>

    <div class="card">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h2 style="margin: 0; border: none; padding: 0;">Clients List</h2>
        <%= link_to "âž• New User", new_admin_client_path, class: "btn btn-success" %>
      </div>
      
      <table>
        <thead>
          <tr>
            <th>Client</th>
            <th>Email</th>
            <th>Commission Rate</th>
            <th>Total Gains</th>
            <th>Commission Due</th>
            <th>Balance Due</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <% @clients.each do |client| %>
            <tr>
              <td><%= "#{client.first_name} #{client.last_name}".strip.presence || "N/A" %></td>
              <td><%= client.email %></td>
              <td><%= number_to_percentage(client.commission_rate, precision: 1) %></td>
              <td class="<%= client.total_profits > 0 ? 'positive' : '' %>">
                <%= number_to_currency(client.total_profits, unit: "$") %>
              </td>
              <td class="<%= client.total_commission_due > 0 ? 'positive' : '' %>">
                <%= number_to_currency(client.total_commission_due, unit: "$") %>
              </td>
              <td>
                <% if client.balance_due > 0 %>
                  <span class="negative"><%= number_to_currency(client.balance_due, unit: "$") %></span>
                <% elsif client.balance_due < 0 %>
                  <span class="positive">Credit: <%= number_to_currency(client.balance_due.abs, unit: "$") %></span>
                <% else %>
                  <span style="color: #666;">$0.00</span>
                <% end %>
              </td>
              <td>
                <div class="action-buttons">
                  <%= link_to "View", admin_client_path(client), class: "btn btn-primary btn-sm" %>
                  <%= button_to "Delete", admin_client_path(client), method: :delete, data: { turbo_confirm: "Delete this user?" }, class: "btn btn-danger btn-sm" %>
                </div>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>

    <div class="card" style="margin-top: 30px;">
      <h2>Administrators</h2>
      
      <table>
        <thead>
          <tr>
            <th>Name</th>
            <th>Email</th>
            <th>Created</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <% @admins.each do |admin| %>
            <tr>
              <td><%= "#{admin.first_name} #{admin.last_name}".strip.presence || "N/A" %></td>
              <td><%= admin.email %></td>
              <td><%= admin.created_at.strftime("%Y-%m-%d") %></td>
              <td>
                <% if admin.id != current_user.id %>
                  <%= button_to "Delete", admin_client_path(admin), method: :delete, data: { turbo_confirm: "Delete this admin?" }, class: "btn btn-danger btn-sm" %>
                <% else %>
                  <span class="text-muted">Current User</span>
                <% end %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>
</body>
</html>

