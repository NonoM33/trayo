<!DOCTYPE html>
<html>
<head>
  <title>Clients - Admin Trayo</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: #f5f5f5; }
    .navbar { background: white; padding: 15px 30px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); display: flex; justify-content: space-between; align-items: center; }
    .navbar h1 { color: #333; font-size: 24px; }
    .navbar a { color: #666; text-decoration: none; padding: 8px 15px; }
    .navbar a:hover { color: #4CAF50; }
    .container { max-width: 1400px; margin: 30px auto; padding: 0 20px; }
    .card { background: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); padding: 30px; }
    h2 { margin-bottom: 25px; color: #333; }
    table { width: 100%; border-collapse: collapse; }
    th, td { text-align: left; padding: 15px; border-bottom: 1px solid #eee; }
    th { background: #f9f9f9; color: #666; font-weight: 600; font-size: 14px; text-transform: uppercase; }
    td { color: #333; }
    .btn-view { display: inline-block; padding: 8px 16px; background: #4CAF50; color: white; text-decoration: none; border-radius: 4px; font-size: 14px; }
    .btn-view:hover { background: #45a049; }
    .positive { color: #4CAF50; font-weight: 600; }
    .negative { color: #f44336; font-weight: 600; }
    .notice { padding: 15px; margin-bottom: 20px; background: #4CAF50; color: white; border-radius: 4px; }
  </style>
</head>
<body>
  <div class="navbar">
    <h1>Trayo Admin</h1>
    <div>
      <span style="margin-right: 20px; color: #333;">Admin: <%= current_user.email %></span>
      <%= link_to "Logout", admin_logout_path, data: { turbo_method: :delete } %>
    </div>
  </div>

  <div class="container">
    <% if flash[:notice] %>
      <div class="notice"><%= flash[:notice] %></div>
    <% end %>
    <% if flash[:alert] %>
      <div class="alert" style="background: #f44336;"><%= flash[:alert] %></div>
    <% end %>

    <div class="card">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h2 style="margin: 0; border: none; padding: 0;">Clients List</h2>
        <%= link_to "âž• New User", new_admin_client_path, class: "btn btn-success" %>
      </div>
      
      <table>
        <thead>
          <tr>
            <th>Client</th>
            <th>Email</th>
            <th>Commission Rate</th>
            <th>Total Gains</th>
            <th>Commission Due</th>
            <th>Balance Due</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <% @clients.each do |client| %>
            <tr>
              <td><%= "#{client.first_name} #{client.last_name}".strip.presence || "N/A" %></td>
              <td><%= client.email %></td>
              <td><%= number_to_percentage(client.commission_rate, precision: 1) %></td>
              <td class="<%= client.total_profits > 0 ? 'positive' : '' %>">
                <%= number_to_currency(client.total_profits, unit: "$") %>
              </td>
              <td class="<%= client.total_commission_due > 0 ? 'positive' : '' %>">
                <%= number_to_currency(client.total_commission_due, unit: "$") %>
              </td>
              <td>
                <% if client.balance_due > 0 %>
                  <span class="negative"><%= number_to_currency(client.balance_due, unit: "$") %></span>
                <% elsif client.balance_due < 0 %>
                  <span class="positive">Credit: <%= number_to_currency(client.balance_due.abs, unit: "$") %></span>
                <% else %>
                  <span style="color: #666;">$0.00</span>
                <% end %>
              </td>
              <td>
                <div class="action-buttons">
                  <%= link_to "View", admin_client_path(client), class: "btn btn-sm" %>
                  <%= button_to "Delete", admin_client_path(client), method: :delete, data: { turbo_confirm: "Delete this user?" }, class: "btn btn-danger btn-sm" %>
                </div>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>

    <div class="card" style="margin-top: 30px;">
      <h2>Administrators</h2>
      
      <table>
        <thead>
          <tr>
            <th>Name</th>
            <th>Email</th>
            <th>Created</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <% @admins.each do |admin| %>
            <tr>
              <td><%= "#{admin.first_name} #{admin.last_name}".strip.presence || "N/A" %></td>
              <td><%= admin.email %></td>
              <td><%= admin.created_at.strftime("%Y-%m-%d") %></td>
              <td>
                <% if admin.id != current_user.id %>
                  <%= button_to "Delete", admin_client_path(admin), method: :delete, data: { turbo_confirm: "Delete this admin?" }, class: "btn btn-danger btn-sm" %>
                <% else %>
                  <span class="text-muted">Current User</span>
                <% end %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>
</body>
</html>

