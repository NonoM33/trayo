<% @page_title = "CrÃ©dits" %>

<% if flash[:notice] %>
  <div class="bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 text-green-800 dark:text-green-200 px-4 py-3 rounded-lg mb-4">
    <%= flash[:notice] %>
  </div>
<% end %>
<% if flash[:alert] %>
  <div class="bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 text-red-800 dark:text-red-200 px-4 py-3 rounded-lg mb-4">
    <%= flash[:alert] %>
  </div>
<% end %>

<div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
  <div class="bg-neutral-50 dark:bg-neutral-900 rounded-lg p-4 border border-neutral-200 dark:border-neutral-800">
    <div class="text-sm text-neutral-600 dark:text-neutral-400 mb-1">Total Credits</div>
    <div class="text-2xl font-bold text-neutral-900 dark:text-white"><%= @credits ? @credits.count : 0 %></div>
  </div>
  <div class="bg-neutral-50 dark:bg-neutral-900 rounded-lg p-4 border border-neutral-200 dark:border-neutral-800">
    <div class="text-sm text-neutral-600 dark:text-neutral-400 mb-1">Total Amount</div>
    <div class="text-2xl font-bold text-green-600 dark:text-green-400">
      <%= @credits ? number_to_currency(@credits.sum(&:amount), unit: "â‚¬", format: "%n %u") : "â‚¬0.00" %>
    </div>
  </div>
  <div class="bg-neutral-50 dark:bg-neutral-900 rounded-lg p-4 border border-neutral-200 dark:border-neutral-800">
    <div class="text-sm text-neutral-600 dark:text-neutral-400 mb-1">Average Credit</div>
    <div class="text-2xl font-bold text-neutral-900 dark:text-white">
      <%= @credits && @credits.any? ? number_to_currency(@credits.sum(&:amount) / @credits.count, unit: "â‚¬", format: "%n %u") : "â‚¬0.00" %>
    </div>
  </div>
  <div class="bg-neutral-50 dark:bg-neutral-900 rounded-lg p-4 border border-neutral-200 dark:border-neutral-800">
    <div class="text-sm text-neutral-600 dark:text-neutral-400 mb-1">Clients Actifs</div>
    <div class="text-2xl font-bold text-neutral-900 dark:text-white">
      <%= @credits ? @credits.map(&:user_id).uniq.count : 0 %>
    </div>
  </div>
</div>

<div class="bg-neutral-50 dark:bg-neutral-900 rounded-lg border border-neutral-200 dark:border-neutral-800 p-6">
  <div class="flex justify-between items-center mb-4">
    <h2 class="text-xl font-bold text-neutral-900 dark:text-white">All Credits</h2>
    <%= link_to "View Clients", admin_clients_path, class: "px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors" %>
  </div>
  
  <% if @credits && @credits.any? %>
    <div class="overflow-x-auto">
      <table class="w-full">
        <thead>
          <tr class="border-b border-neutral-200 dark:border-neutral-800">
            <th class="text-left py-3 px-4 text-sm font-semibold text-neutral-700 dark:text-neutral-300">Date</th>
            <th class="text-left py-3 px-4 text-sm font-semibold text-neutral-700 dark:text-neutral-300">Client</th>
            <th class="text-left py-3 px-4 text-sm font-semibold text-neutral-700 dark:text-neutral-300">Amount</th>
            <th class="text-left py-3 px-4 text-sm font-semibold text-neutral-700 dark:text-neutral-300">Reason</th>
            <th class="text-left py-3 px-4 text-sm font-semibold text-neutral-700 dark:text-neutral-300">Actions</th>
          </tr>
        </thead>
        <tbody>
          <% @credits.each do |credit| %>
            <tr class="border-b border-neutral-200 dark:border-neutral-800 hover:bg-neutral-100 dark:hover:bg-neutral-800/50">
              <td class="py-3 px-4 text-sm"><%= credit.created_at.strftime("%Y-%m-%d %H:%M") %></td>
              <td class="py-3 px-4 text-sm">
                <%= link_to credit.user.email, admin_client_path(credit.user), class: "text-blue-600 dark:text-blue-400 hover:underline" %>
              </td>
              <td class="py-3 px-4 text-sm font-semibold text-green-600 dark:text-green-400">
                <%= number_to_currency(credit.amount, unit: "â‚¬", format: "%n %u") %>
              </td>
              <td class="py-3 px-4 text-sm"><%= credit.reason || "â€”" %></td>
              <td class="py-3 px-4">
                <%= link_to "View Client", admin_client_path(credit.user), class: "px-3 py-1 text-sm border border-neutral-300 dark:border-neutral-700 rounded hover:bg-neutral-100 dark:hover:bg-neutral-800" %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  <% else %>
    <div class="text-center py-20">
      <div class="text-5xl mb-4">ðŸ’³</div>
      <h3 class="text-xl font-bold text-neutral-900 dark:text-white mb-2">No Credits Yet</h3>
      <p class="text-neutral-600 dark:text-neutral-400">Start by adding credits to your clients</p>
    </div>
  <% end %>
</div>
