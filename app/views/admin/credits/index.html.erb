<!DOCTYPE html>
<html>
<head>
  <title>Credits - Admin Trayo</title>
  <%= stylesheet_link_tag "admin" %>
</head>
<body>
  <% @page_title = "Credits Management" %>
  
  <div class="app-layout">
    <%= render 'admin/shared/sidebar' %>
    
    <div class="main-content">
      <%= render 'admin/shared/navbar' %>
      
      <div class="container">
        <% if flash[:notice] %>
          <div class="notice"><%= flash[:notice] %></div>
        <% end %>
        <% if flash[:alert] %>
          <div class="alert"><%= flash[:alert] %></div>
        <% end %>

        <div class="info-grid" style="margin-bottom: 1.5rem;">
          <div class="info-item">
            <div class="info-label">Total Credits</div>
            <div class="info-value"><%= @credits ? @credits.count : 0 %></div>
          </div>
          <div class="info-item">
            <div class="info-label">Total Amount</div>
            <div class="info-value positive">
              <%= @credits ? number_to_currency(@credits.sum(&:amount), unit: "â‚¬", format: "%n %u") : "â‚¬0.00" %>
            </div>
          </div>
          <div class="info-item">
            <div class="info-label">Average Credit</div>
            <div class="info-value">
              <%= @credits && @credits.any? ? number_to_currency(@credits.sum(&:amount) / @credits.count, unit: "â‚¬", format: "%n %u") : "â‚¬0.00" %>
            </div>
          </div>
          <div class="info-item">
            <div class="info-label">Clients Actifs</div>
            <div class="info-value">
              <%= @credits ? @credits.map(&:user_id).uniq.count : 0 %>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <h2>All Credits</h2>
            <%= link_to "View Clients", admin_clients_path, class: "btn btn-primary" %>
          </div>
          
          <% if @credits && @credits.any? %>
            <div class="table-wrapper">
              <table>
                <thead>
                  <tr>
                    <th>Date</th>
                    <th>Client</th>
                    <th>Amount</th>
                    <th>Reason</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  <% @credits.each do |credit| %>
                    <tr>
                      <td><%= credit.created_at.strftime("%Y-%m-%d %H:%M") %></td>
                      <td>
                        <%= link_to credit.user.email, admin_client_path(credit.user), style: "color: var(--color-accent); text-decoration: none;" %>
                      </td>
                      <td class="positive"><%= number_to_currency(credit.amount, unit: "â‚¬", format: "%n %u") %></td>
                      <td><%= credit.reason || "â€”" %></td>
                      <td>
                        <div class="action-buttons">
                          <%= link_to "View Client", admin_client_path(credit.user), class: "btn btn-outline btn-sm" %>
                        </div>
                      </td>
                    </tr>
                  <% end %>
                </tbody>
              </table>
            </div>
          <% else %>
            <div style="text-align: center; padding: 60px 20px;">
              <div style="font-size: 48px; margin-bottom: 20px; color: var(--text-muted);">ðŸ’³</div>
              <h3 style="margin: 0 0 12px 0; font-size: 20px; font-weight: 700; color: var(--text-primary);">No Credits Yet</h3>
              <p style="margin: 0; color: var(--text-muted); font-size: 14px;">Start by adding credits to your clients</p>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</body>
</html>

