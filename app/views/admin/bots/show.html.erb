<!DOCTYPE html>
<html>
<head>
  <title><%= @bot.name %> - Admin Trayo</title>
  <%= stylesheet_link_tag "admin" %>
</head>
<body>
  <% @page_title = @bot.name %>
  
  <div class="app-layout">
    <%= render 'admin/shared/sidebar' %>
    
    <div class="main-content">
      <%= render 'admin/shared/navbar' %>
      
      <div class="container">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
          <%= link_to "← Retour aux Bots", admin_bots_path, class: "back-link", style: "margin: 0;" %>
          <div style="display: flex; gap: 12px;">
            <%= link_to edit_admin_bot_path(@bot), class: "btn btn-primary" do %>
              <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
              </svg>
              Modifier
            <% end %>
            <%= button_to admin_bot_path(@bot), method: :delete,
                data: { turbo_confirm: "Supprimer ce bot ?" }, class: "btn btn-danger" do %>
              <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
              </svg>
              Supprimer
            <% end %>
          </div>
        </div>

        <% if flash[:notice] %>
          <div class="notice"><%= flash[:notice] %></div>
        <% end %>

        <div class="card">
          <div style="display: flex; align-items: start; gap: 24px;">
            <% if @bot.image_url.present? %>
              <img src="<%= @bot.image_url %>" alt="<%= @bot.name %>" 
                   style="width: 120px; height: 120px; object-fit: cover; border-radius: 12px; border: 2px solid var(--border-color);"
                   onerror="this.style.display='none';">
            <% else %>
              <div style="width: 120px; height: 120px; background: linear-gradient(135deg, var(--color-accent), var(--color-accent-hover)); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 48px; color: white;">
                <svg width="48" height="48" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M12 2C13.1 2 14 2.9 14 4C14 5.1 13.1 6 12 6C10.9 6 10 5.1 10 4C10 2.9 10.9 2 12 2ZM21 9V7L15 1H5C3.89 1 3 1.89 3 3V21C3 22.11 3.89 23 5 23H19C20.11 23 21 22.11 21 21V9M19 9H14V4H19V9Z"/>
                </svg>
              </div>
            <% end %>
            
            <div style="flex: 1;">
              <h2 style="margin: 0 0 12px 0;"><%= @bot.name %></h2>
              <div style="display: flex; gap: 12px; margin-bottom: 16px;">
                <span class="risk-badge risk-<%= @bot.risk_level.downcase %>">
                  <%= @bot.risk_label %>
                </span>
                <% if @bot.is_active? %>
                  <span class="status-badge status-validated">Disponible</span>
                <% else %>
                  <span class="status-badge status-inactive">Non Disponible</span>
                <% end %>
              </div>
              <p style="margin: 0; color: var(--text-secondary);"><%= @bot.description %></p>
            </div>
          </div>
        </div>

        <div class="two-col">
          <div class="card">
            <h3>
              <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                <path d="M11.8 10.9c-2.27-.59-3-1.2-3-2.15 0-1.09 1.01-1.85 2.7-1.85 1.78 0 2.44.85 2.5 2.1h2.21c-.07-1.72-1.12-3.3-3.21-3.81V3h-3v2.16c-1.94.42-3.5 1.68-3.5 3.61 0 2.31 1.91 3.46 4.7 4.13 2.5.6 3 1.48 3 2.41 0 .69-.49 1.79-2.7 1.79-2.06 0-2.87-.92-2.98-2.1h-2.2c.12 2.19 1.76 3.42 3.68 3.83V21h3v-2.15c1.95-.37 3.5-1.5 3.5-3.55 0-2.84-2.43-3.81-4.7-4.4z"/>
              </svg>
              Informations Financières
            </h3>
            <div class="info-grid">
              <div class="info-item">
                <div class="info-label">Prix</div>
                <div class="info-value positive"><%= @bot.formatted_price %></div>
              </div>
              <div class="info-item">
                <div class="info-label">Projection Mensuelle</div>
                <div class="info-value">
                  <%= number_to_currency(@bot.projection_monthly_min, unit: "€", format: "%n %u") %> - 
                  <%= number_to_currency(@bot.projection_monthly_max, unit: "€", format: "%n %u") %>
                </div>
              </div>
              <div class="info-item">
                <div class="info-label">Projection Annuelle</div>
                <div class="info-value positive">
                  <%= number_to_currency(@bot.projection_yearly, unit: "€", format: "%n %u") %>
                </div>
              </div>
              <div class="info-item">
                <div class="info-label">Drawdown Max</div>
                <div class="info-value negative">
                  <%= number_to_currency(@bot.max_drawdown_limit, unit: "€", format: "%n %u") %>
                </div>
              </div>
            </div>
          </div>

          <div class="card">
            <h3>
              <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                <path d="M16,11.78L20.24,4.45L21.97,5.45L16.74,14.5L10.23,10.75L5.46,19H22V21H2V3H4V17.54L9.5,8L16,11.78Z"/>
              </svg>
              Performances
            </h3>
            <div class="info-grid">
              <div class="info-item">
                <div class="info-label">Taux de Réussite</div>
                <div class="info-value positive"><%= number_to_percentage(@bot.win_rate, precision: 1) %></div>
              </div>
              <div class="info-item">
                <div class="info-label">Utilisateurs Actifs</div>
                <div class="info-value"><%= @bot.active_users_count %></div>
              </div>
              <div class="info-item">
                <div class="info-label">Performance Moyenne</div>
                <div class="info-value <%= @bot.average_performance > 0 ? 'positive' : 'negative' %>">
                  <%= number_to_currency(@bot.average_performance, unit: "€", format: "%n %u") %>
                </div>
              </div>
              <div class="info-item">
                <div class="info-label">Statut</div>
                <div class="info-value">
                  <% if @bot.status == 'active' %>
                    <span style="color: #4CAF50;">✓ Actif</span>
                  <% else %>
                    <span style="color: #999;">○ Inactif</span>
                  <% end %>
                </div>
              </div>
            </div>
          </div>
        </div>

        <% if @bot.strategy_description.present? %>
          <div class="card">
            <h3>
              <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4M12,6A6,6 0 0,0 6,12A6,6 0 0,0 12,18A6,6 0 0,0 18,12A6,6 0 0,0 12,6M12,8A4,4 0 0,1 16,12A4,4 0 0,1 12,16A4,4 0 0,1 8,12A4,4 0 0,1 12,8Z"/>
              </svg>
              Stratégie de Trading
            </h3>
            <p style="white-space: pre-wrap; line-height: 1.6;"><%= @bot.strategy_description %></p>
          </div>
        <% end %>

        <% if @bot.features_list.any? %>
          <div class="card">
            <h3>
              <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                <path d="M9,11H15L13.5,7.5H10.5L9,11M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2M12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20A8,8 0 0,0 20,12A8,8 0 0,0 12,4M12,6A6,6 0 0,1 18,12A6,6 0 0,1 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6M12,8A4,4 0 0,0 8,12A4,4 0 0,0 12,16A4,4 0 0,0 16,12A4,4 0 0,0 12,8Z"/>
              </svg>
              Caractéristiques Clés
            </h3>
            <ul style="list-style: none; padding: 0; margin: 0;">
              <% @bot.features_list.each do |feature| %>
                <li style="padding: 12px; margin-bottom: 8px; background: var(--bg-hover); border-radius: 8px; display: flex; align-items: center; gap: 12px;">
                  <svg class="icon" style="color: var(--color-success); width: 18px; height: 18px;" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M9,20.42L2.79,14.21L5.62,11.38L9,14.77L18.88,4.88L21.71,7.71L9,20.42Z"/>
                  </svg>
                  <span><%= feature %></span>
                </li>
              <% end %>
            </ul>
          </div>
        <% end %>

        <div class="card">
          <h3>
            <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
              <path d="M16 4c0-1.11.89-2 2-2s2 .89 2 2-.89 2-2 2-2-.89-2-2zm4 18v-6h2.5l-2.54-7.63A1.5 1.5 0 0 0 18.54 7H16.5c-.8 0-1.54.5-1.85 1.26L12.5 15H15v7h5zM12.5 11.5c.83 0 1.5-.67 1.5-1.5s-.67-1.5-1.5-1.5S11 9.17 11 10s.67 1.5 1.5 1.5zM5.5 6c1.11 0 2-.89 2-2s-.89-2-2-2-2 .89-2 2 .89 2 2 2zm2 16v-7H9l-2.15-6.74A1.5 1.5 0 0 0 5.04 7H3.5c-.8 0-1.54.5-1.85 1.26L.5 15H3v7h4.5z"/>
            </svg>
            Clients Utilisant ce Bot
          </h3>
          <% if @purchases.any? %>
            <table>
              <thead>
                <tr>
                  <th>Client</th>
                  <th>Date d'Achat</th>
                  <th>Prix Payé</th>
                  <th>Statut</th>
                  <th>Profit Total</th>
                  <th>Trades</th>
                  <th>Actif</th>
                </tr>
              </thead>
              <tbody>
                <% @purchases.each do |purchase| %>
                  <tr>
                    <td>
                      <%= link_to admin_client_path(purchase.user) do %>
                        <span style="color: white;"><%= purchase.user.email %></span>
                      <% end %>
                    </td>
                    <td><%= purchase.created_at.strftime("%d/%m/%Y") %></td>
                    <td><%= number_to_currency(purchase.price_paid, unit: "€", format: "%n %u") %></td>
                    <td>
                      <% if purchase.status == 'active' %>
                        <span style="color: #4CAF50;">Actif</span>
                      <% else %>
                        <span style="color: #999;">Inactif</span>
                      <% end %>
                    </td>
                    <td class="<%= purchase.total_profit > 0 ? 'positive' : 'negative' %>">
                      <%= number_to_currency(purchase.total_profit, unit: "€", format: "%n %u") %>
                    </td>
                    <td><%= purchase.trades_count %></td>
                    <td>
                      <%= purchase.status_badge %>
                    </td>
                  </tr>
                <% end %>
              </tbody>
            </table>
          <% else %>
            <p style="text-align: center; color: var(--text-muted); padding: 40px;">
              Aucun client n'utilise ce bot pour le moment
            </p>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</body>
</html>
