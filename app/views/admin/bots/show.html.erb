<!DOCTYPE html>
<html>
<head>
  <title><%= @bot.name %> - Admin Trayo</title>
  <%= stylesheet_link_tag "admin" %>
</head>
<body>
  <% @page_title = @bot.name %>
  
  <div class="app-layout">
    <%= render 'admin/shared/sidebar' %>
    
    <div class="main-content">
      <%= render 'admin/shared/navbar' %>
      
      <div class="container">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
          <%= link_to "← Retour aux Bots", admin_bots_path, class: "back-link", style: "margin: 0;" %>
          <div style="display: flex; gap: 12px;">
            <%= link_to "✏️ Modifier", edit_admin_bot_path(@bot), class: "btn btn-primary" %>
            <%= button_to "🗑️ Supprimer", admin_bot_path(@bot), method: :delete,
                data: { turbo_confirm: "Supprimer ce bot ?" }, class: "btn btn-danger" %>
          </div>
        </div>

        <% if flash[:notice] %>
          <div class="notice"><%= flash[:notice] %></div>
        <% end %>

        <div class="card">
          <div style="display: flex; align-items: start; gap: 24px;">
            <% if @bot.image_url.present? %>
              <img src="<%= @bot.image_url %>" alt="<%= @bot.name %>" 
                   style="width: 120px; height: 120px; object-fit: cover; border-radius: 12px; border: 2px solid var(--border-color);">
            <% else %>
              <div style="width: 120px; height: 120px; background: linear-gradient(135deg, var(--color-accent), var(--color-accent-hover)); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 48px; color: white;">
                🤖
              </div>
            <% end %>
            
            <div style="flex: 1;">
              <h2 style="margin: 0 0 12px 0;"><%= @bot.name %></h2>
              <div style="display: flex; gap: 12px; margin-bottom: 16px;">
                <span style="background: <%= @bot.risk_badge_color %>; color: white; padding: 6px 16px; border-radius: 16px; font-size: 13px; font-weight: 600;">
                  <%= @bot.risk_label %>
                </span>
                <% if @bot.is_active? %>
                  <span style="background: #4CAF50; color: white; padding: 6px 16px; border-radius: 16px; font-size: 13px; font-weight: 600;">
                    🟢 Disponible
                  </span>
                <% else %>
                  <span style="background: #999; color: white; padding: 6px 16px; border-radius: 16px; font-size: 13px; font-weight: 600;">
                    🔴 Non Disponible
                  </span>
                <% end %>
              </div>
              <p style="margin: 0; color: var(--text-secondary);"><%= @bot.description %></p>
            </div>
          </div>
        </div>

        <div class="two-col">
          <div class="card">
            <h3>💰 Informations Financières</h3>
            <div class="info-grid">
              <div class="info-item">
                <div class="info-label">Prix</div>
                <div class="info-value positive"><%= @bot.formatted_price %></div>
              </div>
              <div class="info-item">
                <div class="info-label">Projection Mensuelle</div>
                <div class="info-value">
                  <%= number_to_currency(@bot.projection_monthly_min, unit: "€", format: "%n %u") %> - 
                  <%= number_to_currency(@bot.projection_monthly_max, unit: "€", format: "%n %u") %>
                </div>
              </div>
              <div class="info-item">
                <div class="info-label">Projection Annuelle</div>
                <div class="info-value positive">
                  <%= number_to_currency(@bot.projection_yearly, unit: "€", format: "%n %u") %>
                </div>
              </div>
              <div class="info-item">
                <div class="info-label">Drawdown Max</div>
                <div class="info-value negative">
                  <%= number_to_currency(@bot.max_drawdown_limit, unit: "€", format: "%n %u") %>
                </div>
              </div>
            </div>
          </div>

          <div class="card">
            <h3>📊 Performances</h3>
            <div class="info-grid">
              <div class="info-item">
                <div class="info-label">Taux de Réussite</div>
                <div class="info-value positive"><%= number_to_percentage(@bot.win_rate, precision: 1) %></div>
              </div>
              <div class="info-item">
                <div class="info-label">Utilisateurs Actifs</div>
                <div class="info-value"><%= @bot.active_users_count %></div>
              </div>
              <div class="info-item">
                <div class="info-label">Performance Moyenne</div>
                <div class="info-value <%= @bot.average_performance > 0 ? 'positive' : 'negative' %>">
                  <%= number_to_currency(@bot.average_performance, unit: "€", format: "%n %u") %>
                </div>
              </div>
              <div class="info-item">
                <div class="info-label">Statut</div>
                <div class="info-value">
                  <% if @bot.status == 'active' %>
                    <span style="color: #4CAF50;">✓ Actif</span>
                  <% else %>
                    <span style="color: #999;">○ Inactif</span>
                  <% end %>
                </div>
              </div>
            </div>
          </div>
        </div>

        <% if @bot.strategy_description.present? %>
          <div class="card">
            <h3>🎯 Stratégie de Trading</h3>
            <p style="white-space: pre-wrap; line-height: 1.6;"><%= @bot.strategy_description %></p>
          </div>
        <% end %>

        <% if @bot.features_list.any? %>
          <div class="card">
            <h3>✨ Caractéristiques Clés</h3>
            <ul style="list-style: none; padding: 0; margin: 0;">
              <% @bot.features_list.each do |feature| %>
                <li style="padding: 12px; margin-bottom: 8px; background: var(--bg-hover); border-radius: 8px; display: flex; align-items: center; gap: 12px;">
                  <span style="color: var(--color-success); font-size: 18px;">✓</span>
                  <span><%= feature %></span>
                </li>
              <% end %>
            </ul>
          </div>
        <% end %>

        <div class="card">
          <h3>👥 Clients Utilisant ce Bot</h3>
          <% if @purchases.any? %>
            <table>
              <thead>
                <tr>
                  <th>Client</th>
                  <th>Date d'Achat</th>
                  <th>Prix Payé</th>
                  <th>Statut</th>
                  <th>Profit Total</th>
                  <th>Trades</th>
                  <th>Actif</th>
                </tr>
              </thead>
              <tbody>
                <% @purchases.each do |purchase| %>
                  <tr>
                    <td>
                      <%= link_to admin_client_path(purchase.user) do %>
                        <%= purchase.user.email %>
                      <% end %>
                    </td>
                    <td><%= purchase.created_at.strftime("%d/%m/%Y") %></td>
                    <td><%= number_to_currency(purchase.price_paid, unit: "€", format: "%n %u") %></td>
                    <td>
                      <% if purchase.status == 'active' %>
                        <span style="color: #4CAF50;">Actif</span>
                      <% else %>
                        <span style="color: #999;">Inactif</span>
                      <% end %>
                    </td>
                    <td class="<%= purchase.total_profit > 0 ? 'positive' : 'negative' %>">
                      <%= number_to_currency(purchase.total_profit, unit: "€", format: "%n %u") %>
                    </td>
                    <td><%= purchase.trades_count %></td>
                    <td>
                      <%= purchase.status_badge %>
                    </td>
                  </tr>
                <% end %>
              </tbody>
            </table>
          <% else %>
            <p style="text-align: center; color: var(--text-muted); padding: 40px;">
              Aucun client n'utilise ce bot pour le moment
            </p>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</body>
</html>

