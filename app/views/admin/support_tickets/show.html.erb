<%= render 'admin/shared/sidebar' %>

<div class="main-content">
  <%= render 'admin/shared/navbar' %>
  
  <div class="container">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; flex-wrap: wrap; gap: 16px;">
      <div>
        <h1>Ticket #<%= @ticket.ticket_number %></h1>
        <p style="color: var(--text-muted); margin-top: 5px;">
          Créé le <%= @ticket.created_at.strftime("%d/%m/%Y à %H:%M") %>
          <% if @ticket.created_via == "sms" %>
            <span class="badge badge-info" style="margin-left: 10px;">Via SMS</span>
          <% end %>
        </p>
      </div>
      <div>
        <%= link_to "Retour à la liste", admin_support_tickets_path, class: "btn btn-outline" %>
      </div>
    </div>

    <!-- Informations du ticket -->
    <div class="card" style="margin-bottom: 24px;">
      <h2 style="margin-bottom: 20px; border-bottom: 2px solid var(--border-color); padding-bottom: 10px;">
        Informations
      </h2>
      
      <div class="info-grid">
        <div class="info-item">
          <div class="info-label">Statut</div>
          <div class="info-value">
            <span class="status-pill status-<%= @ticket.status %> <%= @ticket.status_badge_class %>">
              <%= @ticket.status_label %>
            </span>
          </div>
        </div>
        <div class="info-item">
          <div class="info-label">Client</div>
          <div class="info-value">
            <% if @ticket.user %>
              <%= link_to @ticket.user.email, admin_client_path(@ticket.user) %>
            <% else %>
              <span class="text-muted">Non identifié</span>
            <% end %>
          </div>
        </div>
        <div class="info-item">
          <div class="info-label">Téléphone</div>
          <div class="info-value"><%= @ticket.phone_number %></div>
        </div>
        <div class="info-item">
          <div class="info-label">Créé via</div>
          <div class="info-value"><%= @ticket.created_via.humanize %></div>
        </div>
      </div>
    </div>

    <!-- Détails du ticket -->
    <div class="card" style="margin-bottom: 24px;">
      <h2 style="margin-bottom: 20px; border-bottom: 2px solid var(--border-color); padding-bottom: 10px;">
        Détails
      </h2>
      
      <%= form_with model: [:admin, @ticket], local: true do |f| %>
        <div style="margin-bottom: 20px;">
          <%= f.label :subject, "Sujet", class: "form-label" %>
          <%= f.text_field :subject, class: "form-control" %>
        </div>

        <div style="margin-bottom: 20px;">
          <%= f.label :description, "Description", class: "form-label" %>
          <%= f.text_area :description, rows: 8, class: "form-control" %>
        </div>

        <div style="margin-bottom: 20px;">
          <%= f.label :status, "Statut", class: "form-label" %>
          <%= f.select :status, 
              options_for_select(SupportTicket::STATUSES.map { |s| [SupportTicket.new(status: s).status_label, s] }, @ticket.status),
              {},
              { class: "form-control" } %>
        </div>

        <div style="display: flex; gap: 10px;">
          <%= f.submit "Mettre à jour", class: "btn btn-primary" %>
          <%= link_to "Annuler", admin_support_tickets_path, class: "btn btn-outline" %>
        </div>
      <% end %>
    </div>

    <!-- Historique -->
    <div class="card">
      <h2 style="margin-bottom: 20px; border-bottom: 2px solid var(--border-color); padding-bottom: 10px;">
        Informations techniques
      </h2>
      
      <div class="info-grid">
        <div class="info-item">
          <div class="info-label">ID SMS</div>
          <div class="info-value">
            <%= @ticket.sms_message_id.presence || "-" %>
          </div>
        </div>
        <div class="info-item">
          <div class="info-label">Lu le</div>
          <div class="info-value">
            <%= @ticket.read_at ? @ticket.read_at.strftime("%d/%m/%Y à %H:%M") : "Non lu" %>
          </div>
        </div>
        <div class="info-item">
          <div class="info-label">Dernière mise à jour</div>
          <div class="info-value">
            <%= @ticket.updated_at.strftime("%d/%m/%Y à %H:%M") %>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

