<% content_for :title, @campaign.name %>

<div class="space-y-6">
  <!-- Header -->
  <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
    <div class="flex items-center gap-4">
      <%= link_to admin_sms_campaigns_path, class: "p-2 rounded-lg hover:bg-neutral-800 text-neutral-400 hover:text-white transition-colors" do %>
        <i class="fa-solid fa-arrow-left"></i>
      <% end %>
      <div>
        <h1 class="text-2xl font-bold text-white"><%= @campaign.name %></h1>
        <p class="text-neutral-400"><%= @campaign.type_label %> ‚Ä¢ <%= @campaign.audience_label %></p>
      </div>
    </div>
    <div class="flex items-center gap-3">
      <span class="px-3 py-1.5 rounded-full text-sm font-medium <%= 
        case @campaign.status
        when 'completed' then 'bg-emerald-500/20 text-emerald-400'
        when 'sending' then 'bg-blue-500/20 text-blue-400'
        when 'scheduled' then 'bg-amber-500/20 text-amber-400'
        else 'bg-neutral-700 text-neutral-300'
        end
      %>">
        <%= case @campaign.status
            when 'completed' then '‚úì Termin√©e'
            when 'sending' then '‚è≥ En cours'
            when 'scheduled' then 'üïê Planifi√©e'
            when 'draft' then 'Brouillon'
            else @campaign.status
            end
        %>
      </span>
      <% if @campaign.draft? %>
        <%= link_to send_campaign_admin_sms_campaign_path(@campaign), method: :post, data: { confirm: "Envoyer cette campagne √† #{@campaign.recipients_count} destinataires ?" }, class: "px-4 py-2 rounded-lg bg-emerald-600 text-white font-medium hover:bg-emerald-700 transition-colors" do %>
          <i class="fa-solid fa-paper-plane mr-2"></i>Envoyer maintenant
        <% end %>
      <% end %>
    </div>
  </div>

  <!-- Stats -->
  <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
    <div class="p-4 rounded-xl bg-neutral-900 border border-neutral-800">
      <div class="text-sm text-neutral-400 mb-1">Destinataires</div>
      <div class="text-2xl font-bold text-white"><%= @campaign.recipients_count %></div>
    </div>
    <div class="p-4 rounded-xl bg-neutral-900 border border-neutral-800">
      <div class="text-sm text-neutral-400 mb-1">Envoy√©s</div>
      <div class="text-2xl font-bold text-emerald-400"><%= @campaign.sent_count %></div>
    </div>
    <div class="p-4 rounded-xl bg-neutral-900 border border-neutral-800">
      <div class="text-sm text-neutral-400 mb-1">√âchecs</div>
      <div class="text-2xl font-bold text-red-400"><%= @campaign.failed_count %></div>
    </div>
    <div class="p-4 rounded-xl bg-neutral-900 border border-neutral-800">
      <div class="text-sm text-neutral-400 mb-1">Taux de succ√®s</div>
      <div class="text-2xl font-bold text-blue-400">
        <%= @campaign.recipients_count > 0 ? ((@campaign.sent_count.to_f / @campaign.recipients_count) * 100).round(1) : 0 %>%
      </div>
    </div>
  </div>

  <!-- Message -->
  <div class="rounded-xl bg-neutral-900 border border-neutral-800 p-6">
    <h3 class="text-lg font-semibold text-white mb-4">Message</h3>
    <div class="rounded-lg bg-neutral-800 p-4">
      <p class="text-white whitespace-pre-wrap"><%= @campaign.message_template %></p>
    </div>
    <% if @campaign.sent_at.present? %>
      <p class="text-sm text-neutral-500 mt-3">
        <i class="fa-solid fa-clock mr-1"></i>
        Envoy√© le <%= @campaign.sent_at.strftime("%d/%m/%Y √† %H:%M") %>
        <% if @campaign.completed_at.present? %>
          ‚Ä¢ Termin√© le <%= @campaign.completed_at.strftime("%d/%m/%Y √† %H:%M") %>
        <% end %>
      </p>
    <% end %>
  </div>

  <!-- Logs -->
  <div class="rounded-xl bg-neutral-900 border border-neutral-800 overflow-hidden">
    <div class="p-4 border-b border-neutral-800">
      <h3 class="text-lg font-semibold text-white">D√©tail des envois</h3>
    </div>
    
    <% if @logs.any? %>
      <div class="overflow-x-auto">
        <table class="w-full !bg-transparent !border-0">
          <thead class="!bg-transparent">
            <tr class="border-b border-neutral-800">
              <th class="px-4 py-3 text-left text-xs font-medium text-neutral-500 uppercase">Client</th>
              <th class="px-4 py-3 text-left text-xs font-medium text-neutral-400 uppercase">T√©l√©phone</th>
              <th class="px-4 py-3 text-left text-xs font-medium text-neutral-400 uppercase">Statut</th>
              <th class="px-4 py-3 text-left text-xs font-medium text-neutral-400 uppercase">Date</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-neutral-800">
            <% @logs.each do |log| %>
              <tr class="hover:bg-neutral-800/30">
                <td class="px-4 py-3">
                  <% if log.user %>
                    <%= link_to log.user.full_name, admin_client_path(log.user), class: "text-white hover:text-blue-400" %>
                  <% else %>
                    <span class="text-neutral-500">Inconnu</span>
                  <% end %>
                </td>
                <td class="px-4 py-3 text-neutral-300 font-mono text-sm"><%= log.phone_number %></td>
                <td class="px-4 py-3">
                  <span class="px-2 py-1 rounded text-xs font-semibold <%= log.status == 'sent' ? 'bg-emerald-500/20 text-emerald-400' : 'bg-red-500/20 text-red-400' %>">
                    <%= log.status == 'sent' ? 'Envoy√©' : '√âchec' %>
                  </span>
                </td>
                <td class="px-4 py-3 text-neutral-400 text-sm"><%= log.sent_at&.strftime("%d/%m/%Y %H:%M") %></td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
      
      <% if @logs.total_pages > 1 %>
        <div class="p-4 border-t border-neutral-800">
          <%= paginate @logs, theme: 'admin' %>
        </div>
      <% end %>
    <% else %>
      <div class="p-12 text-center">
        <i class="fa-solid fa-inbox text-4xl text-neutral-600 mb-4"></i>
        <p class="text-neutral-400">Aucun envoi enregistr√©</p>
      </div>
    <% end %>
  </div>
</div>

