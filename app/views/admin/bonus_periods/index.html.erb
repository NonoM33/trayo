<% @page_title = "Gestion des PÃ©riodes Bonus" %>

<% if flash[:notice] %>
  <div class="bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 text-green-800 dark:text-green-200 px-4 py-3 rounded-lg mb-4">
    <%= flash[:notice] %>
  </div>
<% end %>
<% if flash[:alert] %>
  <div class="bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 text-red-800 dark:text-red-200 px-4 py-3 rounded-lg mb-4">
    <%= flash[:alert] %>
  </div>
<% end %>
        
        <div class="card">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
            <h2><i class="fa-icon fa-md fa-gift"></i> Gestion des PÃ©riodes Bonus</h2>
            <%= link_to "<i class='fa-icon fa-md fa-plus'></i> CrÃ©er une Nouvelle PÃ©riode Bonus".html_safe, new_admin_bonus_period_path, class: "btn btn-success" %>
          </div>
          
          <% if @current_period %>
            <div class="info-box info-box-success">
              <div class="info-box-title">âœ… PÃ©riode Bonus Active Actuelle</div>
              <div style="margin-top: 12px; display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
                <div>
                  <strong><%= @current_period.name || "Unnamed Period" %></strong><br>
                  <span style="color: var(--text-muted);">Bonus: <%= number_to_percentage(@current_period.bonus_percentage, precision: 1) %></span>
                </div>
                <div>
                  <strong>Period:</strong><br>
                  <%= @current_period.start_date.strftime("%B %d, %Y") %> - <%= @current_period.end_date.strftime("%B %d, %Y") %>
                </div>
              </div>
            </div>
          <% else %>
            <div class="info-box info-box-warning">
              <div class="info-box-title"><i class="fa-icon fa-md fa-exclamation-triangle"></i> Aucune PÃ©riode Bonus Active</div>
              <p style="margin: 8px 0 0 0;">There is currently no active bonus period. Create one to enable the bonus program.</p>
            </div>
          <% end %>
          
          <% if @bonus_periods.any? %>
            <table style="margin-top: 24px;">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Campagne</th>
                  <th>Bonus %</th>
                  <th>Date de DÃ©but</th>
                  <th>Date de Fin</th>
                  <th>Statut</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <% @bonus_periods.each do |period| %>
                  <tr>
                    <td>
                      <strong><%= period.name || "Unnamed" %></strong>
                      <% if period.description.present? %>
                        <br><small style="color: var(--text-muted);"><%= truncate(period.description, length: 50) %></small>
                      <% end %>
                    </td>
                    <td>
                      <% if period.campaign %>
                        <div style="display: flex; align-items: center; gap: 8px;">
                          <div style="width: 8px; height: 8px; border-radius: 50%; background: <%= period.campaign.banner_color %>;"></div>
                          <span style="font-weight: 600; color: var(--text-primary);"><%= period.campaign.title %></span>
                        </div>
                      <% else %>
                        <span style="color: var(--text-muted); font-style: italic;">Aucune campagne</span>
                      <% end %>
                    </td>
                    <td class="positive"><strong><%= number_to_percentage(period.bonus_percentage, precision: 1) %></strong></td>
                    <td><%= period.start_date.strftime("%Y-%m-%d") %></td>
                    <td><%= period.end_date.strftime("%Y-%m-%d") %></td>
                    <td>
                      <% if period.current? %>
                        <span class="status-validated">CURRENT</span>
                      <% elsif period.active %>
                        <% if period.start_date > Date.current %>
                          <span class="status-pending">UPCOMING</span>
                        <% else %>
                          <span class="status-badge status-inactive">EXPIRED</span>
                        <% end %>
                      <% else %>
                        <span class="status-rejected">INACTIVE</span>
                      <% end %>
                    </td>
                    <td>
                      <div class="action-buttons">
                        <%= link_to "Modifier", edit_admin_bonus_period_path(period), class: "btn btn-primary btn-sm" %>
                        <%= button_to period.active ? "Deactivate" : "Activate", 
                                      toggle_active_admin_bonus_period_path(period), 
                                      method: :post, 
                                      class: period.active ? "btn btn-warning btn-sm" : "btn btn-success btn-sm" %>
                        <%= button_to "Supprimer", admin_bonus_period_path(period), 
                                      method: :delete, 
                                      data: { confirm: "Are you sure you want to delete this bonus period?" },
                                      class: "btn btn-danger btn-sm" %>
                      </div>
                    </td>
                  </tr>
                <% end %>
              </tbody>
            </table>
          <% else %>
            <p style="text-align: center; color: var(--text-muted); padding: 40px;">No bonus periods configured yet</p>
          <% end %>
        </div>
        
        <div class="card">
          <h3>ðŸ’¡ Quick Guide</h3>
          <ul style="margin: 12px 0; padding-left: 20px; line-height: 1.8;">
            <li><strong>Les pÃ©riodes actives</strong> peuvent Ãªtre utilisÃ©es pour les calculs de bonus</li>
            <li><strong>Only one period</strong> can be active for any given date range</li>
            <li>The system automatically selects the <strong>current active period</strong> based on today's date</li>
            <li>You can <strong>deactivate</strong> a period without deleting it</li>
            <li>Users will see the current bonus rate when making deposits</li>
          </ul>
        </div>