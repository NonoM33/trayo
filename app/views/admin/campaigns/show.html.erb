<!DOCTYPE html>
<html>
<head>
  <title>Détails Campagne - Admin Trayo</title>
  <%= stylesheet_link_tag "admin" %>
</head>
<body>
  <% @page_title = "Détails Campagne" %>
  
  <div class="app-layout">
    <%= render 'admin/shared/sidebar' %>
    
    <div class="main-content">
      <%= render 'admin/shared/navbar' %>
      
      <div class="container">
        <div class="card">
          <div class="card-header">
            <h2><%= @campaign.title %></h2>
            <div class="action-buttons">
              <%= link_to "Modifier", edit_admin_campaign_path(@campaign), class: "btn btn-primary" %>
              <%= link_to "Retour", admin_campaigns_path, class: "btn btn-outline" %>
            </div>
          </div>
          
          <div class="card-body">
            <div class="two-col">
              <div class="info-item">
                <label>Titre</label>
                <div class="info-value"><%= @campaign.title %></div>
              </div>
              
              <div class="info-item">
                <label>Statut</label>
                <div class="info-value">
                  <span class="status-badge <%= @campaign.is_active ? 'status-active' : 'status-inactive' %>">
                    <%= @campaign.is_active ? 'ACTIVE' : 'INACTIVE' %>
                  </span>
                </div>
              </div>
              
              <div class="info-item">
                <label>Date de Début</label>
                <div class="info-value"><%= @campaign.start_date&.strftime("%d/%m/%Y à %H:%M") %></div>
              </div>
              
              <div class="info-item">
                <label>Date de Fin</label>
                <div class="info-value"><%= @campaign.end_date&.strftime("%d/%m/%Y à %H:%M") %></div>
              </div>
              
              <div class="info-item">
                <label>Jours Restants</label>
                <div class="info-value">
                  <% if @campaign.active_and_current? %>
                    <span class="status-badge status-validated"><%= @campaign.days_remaining %> jours</span>
                  <% else %>
                    <span class="status-badge status-inactive">Terminée</span>
                  <% end %>
                </div>
              </div>
              
              <div class="info-item">
                <label>Progression</label>
                <div class="info-value">
                  <% if @campaign.active_and_current? %>
                    <div class="progress-bar">
                      <div class="progress-fill" style="width: <%= @campaign.progress_percentage %>%"></div>
                    </div>
                    <small><%= @campaign.progress_percentage %>% complété</small>
                  <% else %>
                    <span class="status-badge status-inactive">N/A</span>
                  <% end %>
                </div>
              </div>
            </div>
            
            <div class="form-group">
              <label>Description</label>
              <div class="info-value"><%= simple_format(@campaign.description) %></div>
            </div>
            
            <div class="two-col">
              <div class="form-group">
                <label>Couleur de la Bannière</label>
                <div class="info-value">
                  <div style="display: flex; align-items: center; gap: 8px;">
                    <div style="width: 20px; height: 20px; background-color: <%= @campaign.banner_color %>; border-radius: 4px; border: 1px solid var(--border-color);"></div>
                    <span><%= @campaign.banner_color %></span>
                  </div>
                </div>
              </div>
              
              <div class="form-group">
                <label>Titre de la Popup</label>
                <div class="info-value"><%= @campaign.popup_title %></div>
              </div>
            </div>
            
            <div class="form-group">
              <label>Message de la Popup</label>
              <div class="info-value"><%= simple_format(@campaign.popup_message) %></div>
            </div>
            
            <div class="two-col">
              <div class="info-item">
                <label>Créé le</label>
                <div class="info-value"><%= @campaign.created_at&.strftime("%d/%m/%Y à %H:%M") %></div>
              </div>
              
              <div class="info-item">
                <label>Modifié le</label>
                <div class="info-value"><%= @campaign.updated_at&.strftime("%d/%m/%Y à %H:%M") %></div>
              </div>
            </div>
          </div>
          
          <% if @campaign.bonus_periods.any? %>
            <div class="card">
              <div class="card-header">
                <h3><i class="fa-icon fa-md fa-gift"></i> Périodes Bonus Associées</h3>
                <%= link_to "Nouvelle Période Bonus", new_admin_bonus_period_path(campaign_id: @campaign.id), class: "btn btn-success btn-sm" %>
              </div>
              <div class="card-body">
                <div class="table-wrapper">
                  <table>
                    <thead>
                      <tr>
                        <th>Nom</th>
                        <th>Bonus %</th>
                        <th>Période</th>
                        <th>Statut</th>
                        <th>Actions</th>
                      </tr>
                    </thead>
                    <tbody>
                      <% @campaign.bonus_periods.each do |period| %>
                        <tr>
                          <td>
                            <strong><%= period.name || "Sans nom" %></strong>
                            <% if period.description.present? %>
                              <br><small style="color: var(--text-muted);"><%= truncate(period.description, length: 50) %></small>
                            <% end %>
                          </td>
                          <td class="positive"><strong><%= number_to_percentage(period.bonus_percentage, precision: 1) %></strong></td>
                          <td>
                            <%= period.start_date.strftime("%d/%m/%Y") %> - <%= period.end_date.strftime("%d/%m/%Y") %>
                          </td>
                          <td>
                            <% if period.current? %>
                              <span class="status-badge status-validated">Actuelle</span>
                            <% elsif period.active %>
                              <% if period.start_date > Date.current %>
                                <span class="status-badge status-pending">À venir</span>
                              <% else %>
                                <span class="status-badge status-inactive">Expirée</span>
                              <% end %>
                            <% else %>
                              <span class="status-badge status-inactive">Inactive</span>
                            <% end %>
                          </td>
                          <td>
                            <div class="action-buttons">
                              <%= link_to "Voir", admin_bonus_period_path(period), class: "btn btn-outline btn-sm" %>
                              <%= link_to "Modifier", edit_admin_bonus_period_path(period), class: "btn btn-warning btn-sm" %>
                            </div>
                          </td>
                        </tr>
                      <% end %>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          <% else %>
            <div class="card">
              <div class="card-header">
                <h3><i class="fa-icon fa-md fa-gift"></i> Périodes Bonus Associées</h3>
                <%= link_to "Créer une Période Bonus", new_admin_bonus_period_path(campaign_id: @campaign.id), class: "btn btn-success" %>
              </div>
              <div class="card-body">
                <div style="text-align: center; padding: 40px; color: var(--text-muted);">
                  <div style="font-size: 48px; margin-bottom: 16px;"><i class="fa-icon fa-md fa-gift"></i></div>
                  <h4 style="margin: 0 0 8px 0; color: var(--text-primary);">Aucune période bonus associée</h4>
                  <p style="margin: 0;">Créez une période bonus pour cette campagne</p>
                </div>
              </div>
            </div>
          <% end %>
          
          <div class="card-footer">
            <div class="action-buttons">
              <%= link_to "Modifier", edit_admin_campaign_path(@campaign), class: "btn btn-primary" %>
              <%= link_to "Retour à la Liste", admin_campaigns_path, class: "btn btn-outline" %>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</body>
</html>
