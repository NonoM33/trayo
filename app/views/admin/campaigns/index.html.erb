<!DOCTYPE html>
<html>
<head>
  <title>Campagnes - Admin Trayo</title>
  <%= stylesheet_link_tag "admin" %>
</head>
<body>
  <% @page_title = "Gestion des Campagnes" %>
  
  <div class="app-layout">
    <%= render 'admin/shared/sidebar' %>
    
    <div class="main-content">
      <%= render 'admin/shared/navbar' %>
      
      <div class="container">
        <% if flash[:notice] %>
          <div class="notice"><%= flash[:notice] %></div>
        <% end %>
        <% if flash[:alert] %>
          <div class="alert"><%= flash[:alert] %></div>
        <% end %>

        <div class="info-grid" style="margin-bottom: 1.5rem;">
          <div class="info-item">
            <div class="info-label">Total Campagnes</div>
            <div class="info-value"><%= @campaigns.count %></div>
          </div>
          <div class="info-item">
            <div class="info-label">Campagnes Actives</div>
            <div class="info-value"><%= @campaigns.active.count %></div>
          </div>
          <div class="info-item">
            <div class="info-label">Campagnes en Cours</div>
            <div class="info-value"><%= @campaigns.active_current.count %></div>
          </div>
          <div class="info-item">
            <div class="info-label">Prochaines Campagnes</div>
            <div class="info-value"><%= @campaigns.where('start_date > ?', Time.current).count %></div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <h2>Liste des Campagnes</h2>
            <%= link_to "Nouvelle Campagne", new_admin_campaign_path, class: "btn btn-primary" %>
          </div>
          
          <% if @campaigns.any? %>
            <div class="table-wrapper">
              <table>
                <thead>
                  <tr>
                    <th>Titre</th>
                    <th>Description</th>
                    <th>Période</th>
                    <th>Statut</th>
                    <th>Progression</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  <% @campaigns.each do |campaign| %>
                    <tr>
                      <td>
                        <div style="font-weight: 600; color: var(--text-primary);">
                          <%= campaign.title %>
                        </div>
                        <div style="font-size: 12px; color: var(--text-muted);">
                          <%= campaign.banner_color %>
                        </div>
                      </td>
                      <td style="max-width: 200px;">
                        <div style="font-size: 13px; color: var(--text-secondary); line-height: 1.4;">
                          <%= truncate(campaign.description, length: 100) %>
                        </div>
                      </td>
                      <td>
                        <div style="font-size: 13px;">
                          <div style="font-weight: 600; color: var(--text-primary);">
                            <%= campaign.start_date.strftime("%d/%m/%Y") %>
                          </div>
                          <div style="color: var(--text-muted);">
                            au <%= campaign.end_date.strftime("%d/%m/%Y") %>
                          </div>
                        </div>
                      </td>
                      <td>
                        <% if campaign.active_and_current? %>
                          <span class="status-badge status-validated">En Cours</span>
                        <% elsif campaign.is_active? %>
                          <span class="status-badge status-pending">Active</span>
                        <% else %>
                          <span class="status-badge status-inactive">Inactive</span>
                        <% end %>
                      </td>
                      <td>
                        <% if campaign.current? %>
                          <div style="min-width: 100px;">
                            <div style="background: var(--bg-hover); height: 6px; border-radius: var(--radius-full); overflow: hidden; margin-bottom: 4px;">
                              <div style="width: <%= campaign.progress_percentage %>%; height: 100%; background: var(--color-accent); border-radius: var(--radius-full);"></div>
                            </div>
                            <div style="font-size: 11px; color: var(--text-muted); text-align: center;">
                              <%= campaign.progress_percentage %>% • <%= campaign.days_remaining %> jours
                            </div>
                          </div>
                        <% else %>
                          <span style="color: var(--text-muted); font-size: 12px;">
                            <%= campaign.start_date > Time.current ? 'À venir' : 'Terminée' %>
                          </span>
                        <% end %>
                      </td>
                      <td>
                        <div class="action-buttons">
                          <%= link_to "Voir", admin_campaign_path(campaign), class: "btn btn-outline btn-sm" %>
                          <%= link_to "Modifier", edit_admin_campaign_path(campaign), class: "btn btn-warning btn-sm" %>
                          <%= button_to campaign.is_active? ? "Désactiver" : "Activer", 
                                toggle_active_admin_campaign_path(campaign), 
                                method: :post, 
                                class: campaign.is_active? ? "btn btn-danger btn-sm" : "btn btn-success btn-sm" %>
                        </div>
                      </td>
                    </tr>
                  <% end %>
                </tbody>
              </table>
            </div>
          <% else %>
            <div style="text-align: center; padding: 60px 20px;">
              <div style="font-size: 48px; margin-bottom: 20px; color: var(--text-muted);"><i class="fa-icon fa-md fa-bullhorn"></i></div>
              <h3 style="margin: 0 0 12px 0; font-size: 20px; font-weight: 700; color: var(--text-primary);">Aucune Campagne</h3>
              <p style="margin: 0; color: var(--text-muted); font-size: 14px;">Créez votre première campagne pour commencer</p>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</body>
</html>
