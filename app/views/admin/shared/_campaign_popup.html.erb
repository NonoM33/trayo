<!-- Campaign Popup -->
<% if @current_campaign&.active_and_current? %>
  <div id="campaign-popup" class="campaign-popup" style="display: none;">
    <div class="campaign-popup-overlay" onclick="closeCampaignPopup()"></div>
    <div class="campaign-popup-content">
      <div class="campaign-popup-header" style="background: <%= @current_campaign.banner_color %>; color: white; padding: 20px; border-radius: var(--radius-lg) var(--radius-lg) 0 0;">
        <h2 style="margin: 0; font-size: 24px; font-weight: 700; display: flex; align-items: center; gap: 12px;">
          ðŸŽ¯ <%= @current_campaign.popup_title %>
        </h2>
        <button onclick="closeCampaignPopup()" style="position: absolute; top: 16px; right: 16px; background: rgba(255, 255, 255, 0.2); border: none; color: white; width: 32px; height: 32px; border-radius: var(--radius-full); cursor: pointer; font-size: 16px; display: flex; align-items: center; justify-content: center;">
          âœ•
        </button>
      </div>
      
      <div class="campaign-popup-body" style="padding: 24px;">
        <div style="margin-bottom: 20px;">
          <p style="margin: 0; font-size: 16px; line-height: 1.6; color: var(--text-primary);">
            <%= simple_format(@current_campaign.popup_message) %>
          </p>
        </div>
        
        <div style="display: flex; align-items: center; gap: 20px; margin-bottom: 24px; padding: 16px; background: var(--bg-hover); border-radius: var(--radius-md);">
          <div style="text-align: center;">
            <div style="font-size: 28px; font-weight: 800; color: var(--color-accent); margin-bottom: 4px;">
              <%= @current_campaign.days_remaining %>
            </div>
            <div style="font-size: 12px; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.5px;">
              <% if Date.current < @current_campaign.start_date.to_date %>
                Jours avant dÃ©but
              <% else %>
                Jours restants
              <% end %>
            </div>
          </div>
          
          <div style="flex: 1;">
            <div style="background: var(--border-color); height: 8px; border-radius: var(--radius-full); overflow: hidden;">
              <div style="width: <%= @current_campaign.progress_percentage %>%; height: 100%; background: var(--color-accent); border-radius: var(--radius-full); transition: width 0.3s ease;"></div>
            </div>
            <div style="font-size: 12px; text-align: center; margin-top: 6px; color: var(--text-secondary);">
              <% if Date.current < @current_campaign.start_date.to_date %>
                Campagne commence dans <%= (@current_campaign.start_date.to_date - Date.current).to_i %> jour<%= (@current_campaign.start_date.to_date - Date.current).to_i > 1 ? 's' : '' %>
              <% elsif @current_campaign.progress_percentage >= 100 %>
                Campagne terminÃ©e
              <% else %>
                <%= @current_campaign.progress_percentage %>% de la campagne terminÃ©
              <% end %>
            </div>
          </div>
        </div>
        
        <div style="display: flex; gap: 12px; justify-content: flex-end;">
          <% if @current_campaign.has_button? %>
            <a href="<%= @current_campaign.button_url %>" target="_blank" class="btn btn-primary btn-sm">
              <%= @current_campaign.button_text %>
            </a>
          <% end %>
          <button onclick="closeCampaignPopup()" class="btn btn-outline btn-sm">
            Fermer
          </button>
          <button onclick="closeCampaignPopup(true)" class="btn btn-secondary btn-sm">
            Ne plus afficher aujourd'hui
          </button>
        </div>
      </div>
    </div>
  </div>
  
  <style>
    .campaign-popup {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      z-index: 9999;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    
    .campaign-popup-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(4px);
    }
    
    .campaign-popup-content {
      position: relative;
      background: var(--bg-card);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-2xl);
      max-width: 500px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      animation: popupSlideIn 0.4s ease-out;
    }
    
    @keyframes popupSlideIn {
      from {
        opacity: 0;
        transform: scale(0.9) translateY(20px);
      }
      to {
        opacity: 1;
        transform: scale(1) translateY(0);
      }
    }
    
    @keyframes popupSlideOut {
      from {
        opacity: 1;
        transform: scale(1) translateY(0);
      }
      to {
        opacity: 0;
        transform: scale(0.9) translateY(20px);
      }
    }
    
    @media (max-width: 768px) {
      .campaign-popup {
        padding: 10px;
      }
      
      .campaign-popup-content {
        max-width: 100%;
      }
      
      .campaign-popup-header h2 {
        font-size: 20px;
      }
      
      .campaign-popup-body {
        padding: 20px;
      }
    }
  </style>
  
  <script>
    function showCampaignPopup() {
      const popup = document.getElementById('campaign-popup');
      if (popup) {
        popup.style.display = 'flex';
        document.body.style.overflow = 'hidden';
      }
    }
    
    function closeCampaignPopup(dismissToday = false) {
      const popup = document.getElementById('campaign-popup');
      if (popup) {
        popup.style.animation = 'popupSlideOut 0.3s ease-out forwards';
        document.body.style.overflow = '';
        
        if (dismissToday) {
          localStorage.setItem('campaign_dismissed_today', new Date().toDateString());
        }
        
        setTimeout(() => {
          popup.style.display = 'none';
        }, 300);
      }
    }
    
    // Check if popup should be shown
    document.addEventListener('DOMContentLoaded', function() {
      const dismissedToday = localStorage.getItem('campaign_dismissed_today');
      const today = new Date().toDateString();
      
      if (dismissedToday !== today) {
        // Show popup after a short delay
        setTimeout(showCampaignPopup, 1000);
      }
    });
  </script>
<% end %>
