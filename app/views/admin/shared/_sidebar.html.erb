<div class="sidebar" id="mainSidebar">
  <div class="sidebar-header">
    <div class="sidebar-logo">
      <div class="sidebar-logo-icon" onclick="toggleSidebarCollapse()" style="cursor: pointer;" title="Toggle sidebar">T</div>
      <span><%= current_user.is_admin? ? 'Trayo Admin' : 'Trayo' %></span>
    </div>
    <button class="sidebar-toggle-btn" onclick="toggleSidebarCollapse()" id="sidebarToggleBtn" title="Collapse sidebar">
      â†
    </button>
  </div>
  
  <nav class="sidebar-nav">
    <div class="sidebar-section">
      <div class="sidebar-section-title">Main</div>
      <ul class="sidebar-menu">
        <% if current_user.is_admin? %>
          <li class="sidebar-menu-item">
            <%= link_to admin_clients_path, class: "sidebar-menu-link #{request.path == admin_clients_path ? 'active' : ''}" do %>
              <span class="sidebar-menu-icon">ğŸ‘¥</span>
              <span>Clients</span>
            <% end %>
          </li>
          <li class="sidebar-menu-item">
            <%= link_to admin_payments_path, class: "sidebar-menu-link #{request.path == admin_payments_path ? 'active' : ''}" do %>
              <span class="sidebar-menu-icon">ğŸ’°</span>
              <span>Payments</span>
            <% end %>
          </li>
          <li class="sidebar-menu-item">
            <%= link_to admin_credits_path, class: "sidebar-menu-link #{request.path == admin_credits_path ? 'active' : ''}" do %>
              <span class="sidebar-menu-icon">ğŸ«</span>
              <span>Credits</span>
            <% end %>
          </li>
          <li class="sidebar-menu-item">
            <%= link_to admin_bonus_deposits_path, class: "sidebar-menu-link #{request.path.start_with?('/admin/bonus') ? 'active' : ''}" do %>
              <span class="sidebar-menu-icon">ğŸ</span>
              <span>Bonus Deposits</span>
            <% end %>
          </li>
        <% else %>
          <li class="sidebar-menu-item">
            <%= link_to admin_dashboard_path, class: "sidebar-menu-link #{request.path == admin_dashboard_path ? 'active' : ''}" do %>
              <span class="sidebar-menu-icon">ğŸ“Š</span>
              <span>Dashboard</span>
            <% end %>
          </li>
          <li class="sidebar-menu-item">
            <%= link_to admin_client_path(current_user), class: "sidebar-menu-link #{request.path == admin_client_path(current_user) ? 'active' : ''}" do %>
              <span class="sidebar-menu-icon">ğŸ‘¤</span>
              <span>My Profile</span>
            <% end %>
          </li>
          <li class="sidebar-menu-item">
            <%= link_to admin_shop_index_path, class: "sidebar-menu-link #{request.path.start_with?('/admin/shop') ? 'active' : ''}" do %>
              <span class="sidebar-menu-icon">ğŸ›’</span>
              <span>Shop</span>
            <% end %>
          </li>
          <li class="sidebar-menu-item">
            <%= link_to admin_bonus_deposits_path, class: "sidebar-menu-link #{request.path.start_with?('/admin/bonus') ? 'active' : ''}" do %>
              <span class="sidebar-menu-icon">ğŸ</span>
              <span>Bonus Program</span>
            <% end %>
          </li>
        <% end %>
      </ul>
    </div>
    
    <div class="sidebar-section">
      <div class="sidebar-section-title">Settings</div>
      <ul class="sidebar-menu">
        <li class="sidebar-menu-item">
          <a href="#" class="sidebar-menu-link">
            <span class="sidebar-menu-icon">âš™ï¸</span>
            <span>Configuration</span>
          </a>
        </li>
        <li class="sidebar-menu-item">
          <button class="sidebar-menu-link" onclick="toggleTheme()" style="width: 100%; background: none; border: none; cursor: pointer;">
            <span class="sidebar-menu-icon theme-icon" id="sidebarThemeIcon">ğŸŒ™</span>
            <span>Theme</span>
          </button>
        </li>
      </ul>
    </div>
  </nav>
  
  <div class="sidebar-footer">
    <div class="sidebar-user">
      <div class="sidebar-user-avatar">
        <%= current_user.email[0].upcase %>
      </div>
      <div class="sidebar-user-info">
        <div class="sidebar-user-name"><%= current_user.first_name || current_user.email.split('@').first %></div>
        <div class="sidebar-user-role"><%= current_user.is_admin? ? 'Administrator' : 'Client' %></div>
      </div>
    </div>
    <%= link_to "Logout", admin_logout_path, data: { turbo_method: :delete }, style: "display: block; text-align: center; margin-top: 8px; color: var(--text-muted); font-size: 12px; text-decoration: none;" %>
  </div>
</div>

<script>
      function toggleSidebarCollapse() {
        const sidebar = document.getElementById('mainSidebar');
        const toggleBtn = document.getElementById('sidebarToggleBtn');
        const isCollapsed = sidebar.classList.toggle('collapsed');
        
        toggleBtn.textContent = isCollapsed ? 'â†’' : 'â†';
        toggleBtn.title = isCollapsed ? 'Expand sidebar' : 'Collapse sidebar';
        
        localStorage.setItem('sidebarCollapsed', isCollapsed ? 'true' : 'false');
        document.documentElement.classList.toggle('sidebar-collapsed-init', isCollapsed);
      }
  
  // Update sidebar theme icon
  function updateSidebarThemeIcon() {
    const sidebarIcon = document.getElementById('sidebarThemeIcon');
    if (sidebarIcon) {
      if (document.body.classList.contains('dark-mode')) {
        sidebarIcon.textContent = 'â˜€ï¸';
      } else {
        sidebarIcon.textContent = 'ğŸŒ™';
      }
    }
  }
  
  // Override toggleTheme to update both icons
  const originalToggleTheme = window.toggleTheme;
  window.toggleTheme = function() {
    const body = document.body;
    const navIcon = document.getElementById('themeIcon');
    
    if (body.classList.contains('dark-mode')) {
      body.classList.remove('dark-mode');
      if (navIcon) navIcon.textContent = 'ğŸŒ™';
      localStorage.setItem('theme', 'light');
    } else {
      body.classList.add('dark-mode');
      if (navIcon) navIcon.textContent = 'â˜€ï¸';
      localStorage.setItem('theme', 'dark');
    }
    
    updateSidebarThemeIcon();
  };
  
      // Initialize immediately
      (function() {
        const sidebar = document.getElementById('mainSidebar');
        const toggleBtn = document.getElementById('sidebarToggleBtn');
        const isCollapsed = localStorage.getItem('sidebarCollapsed') === 'true';
        
        if (isCollapsed && sidebar && toggleBtn) {
          sidebar.classList.add('collapsed');
          toggleBtn.textContent = 'â†’';
          toggleBtn.title = 'Expand sidebar';
        }
        
        updateSidebarThemeIcon();
      })();
</script>

