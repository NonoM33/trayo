<div class="sidebar-mobile-overlay" id="sidebarOverlay" onclick="toggleMobileSidebar()"></div>

<div class="sidebar" id="mainSidebar">
  <div class="sidebar-header">
    <div class="sidebar-logo">
      <div class="sidebar-logo-icon" onclick="toggleSidebarCollapse()" title="Réduire/Agrandir la barre latérale">T</div>
      <span><%= current_user.is_admin? ? 'Trayo Admin' : 'Trayo' %></span>
    </div>
    <button class="sidebar-toggle-btn" onclick="toggleSidebarCollapse()" id="sidebarToggleBtn" title="Réduire la barre latérale">
      <i class="fa-icon fa-md fa-chevron-left"></i>
    </button>
  </div>
  
  <nav class="sidebar-nav">
    <div class="sidebar-section">
      <div class="sidebar-section-title">Principal</div>
      <ul class="sidebar-menu">
        <% if current_user.is_admin? %>
          <li class="sidebar-menu-item">
            <%= link_to admin_clients_path, class: "sidebar-menu-link #{request.path == admin_clients_path ? 'active' : ''}" do %>
              <i class="fa-icon fa-md fa-users"></i>
              <span>Clients</span>
            <% end %>
          </li>
          <li class="sidebar-menu-item">
            <%= link_to admin_bots_path, class: "sidebar-menu-link #{request.path.start_with?('/admin/bots') ? 'active' : ''}" do %>
              <i class="fa-icon fa-md fa-robot"></i>
              <span>Bots Trading</span>
            <% end %>
          </li>
          <li class="sidebar-menu-item">
            <%= link_to admin_payments_path, class: "sidebar-menu-link #{request.path == admin_payments_path ? 'active' : ''}" do %>
              <i class="fa-icon fa-md fa-credit-card"></i>
              <span>Paiements</span>
            <% end %>
          </li>
          <li class="sidebar-menu-item">
            <%= link_to admin_credits_path, class: "sidebar-menu-link #{request.path == admin_credits_path ? 'active' : ''}" do %>
              <i class="fa-icon fa-md fa-gift"></i>
              <span>Crédits</span>
            <% end %>
          </li>
          <li class="sidebar-menu-item">
            <%= link_to admin_bonus_deposits_path, class: "sidebar-menu-link #{request.path.start_with?('/admin/bonus_deposit') ? 'active' : ''}" do %>
              <i class="fa-icon fa-md fa-gift"></i>
              <span>Dépôts Bonus</span>
            <% end %>
          </li>
          <li class="sidebar-menu-item">
            <%= link_to admin_bonus_periods_path, class: "sidebar-menu-link #{request.path.start_with?('/admin/bonus_period') ? 'active' : ''}" do %>
              <i class="fa-icon fa-md fa-calendar"></i>
              <span>Périodes Bonus</span>
            <% end %>
          </li>
          <li class="sidebar-menu-item">
            <%= link_to admin_vps_path, class: "sidebar-menu-link #{request.path.start_with?('/admin/vps') ? 'active' : ''}" do %>
              <i class="fa-icon fa-md fa-desktop"></i>
              <span>VPS</span>
            <% end %>
          </li>
          <li class="sidebar-menu-item">
            <%= link_to admin_campaigns_path, class: "sidebar-menu-link #{request.path.start_with?('/admin/campaigns') ? 'active' : ''}" do %>
              <i class="fa-icon fa-md fa-bullhorn"></i>
              <span>Campagnes</span>
            <% end %>
          </li>
          <li class="sidebar-menu-item">
            <%= link_to admin_trades_path, class: "sidebar-menu-link #{request.path.start_with?('/admin/trades') ? 'active' : ''}" do %>
              <i class="fa-icon fa-md fa-chart-line"></i>
              <span>Trades</span>
            <% end %>
          </li>
          <li class="sidebar-menu-item">
            <%= link_to admin_maintenance_path, class: "sidebar-menu-link #{request.path.start_with?('/admin/maintenance') ? 'active' : ''}" do %>
              <i class="fa-icon fa-md fa-tools"></i>
              <span>Maintenance</span>
            <% end %>
          </li>
        <% else %>
          <li class="sidebar-menu-item">
            <%= link_to admin_dashboard_path, class: "sidebar-menu-link #{request.path == admin_dashboard_path ? 'active' : ''}" do %>
              <i class="fa-icon fa-md fa-tachometer-alt"></i>
              <span>Tableau de Bord</span>
            <% end %>
          </li>
          <li class="sidebar-menu-item">
            <%= link_to admin_client_path(current_user), class: "sidebar-menu-link #{request.path == admin_client_path(current_user) ? 'active' : ''}" do %>
              <i class="fa-icon fa-md fa-user"></i>
              <span>Mon Profil</span>
            <% end %>
          </li>
          <li class="sidebar-menu-item">
            <%= link_to admin_shop_index_path, class: "sidebar-menu-link #{request.path.start_with?('/admin/shop') ? 'active' : ''}" do %>
              <i class="fa-icon fa-md fa-shopping-cart"></i>
              <span>Boutique</span>
            <% end %>
          </li>
          <li class="sidebar-menu-item">
            <%= link_to admin_my_bots_path, class: "sidebar-menu-link #{request.path.start_with?('/admin/my_bots') ? 'active' : ''}" do %>
              <i class="fa-icon fa-md fa-robot"></i>
              <span>Mes Bots</span>
            <% end %>
          </li>
          <li class="sidebar-menu-item">
            <%= link_to admin_bonus_deposits_path, class: "sidebar-menu-link #{request.path.start_with?('/admin/bonus') ? 'active' : ''}" do %>
              <i class="fa-icon fa-md fa-gift"></i>
              <span>Programme Bonus</span>
            <% end %>
          </li>
          <li class="sidebar-menu-item">
            <%= link_to admin_vps_path, class: "sidebar-menu-link #{request.path.start_with?('/admin/vps') ? 'active' : ''}" do %>
              <i class="fa-icon fa-md fa-desktop"></i>
              <span>Mes VPS</span>
            <% end %>
          </li>
        <% end %>
      </ul>
    </div>
  </nav>
  
  <div class="sidebar-footer">
    <div class="sidebar-user" onclick="openUserSettings()" title="Paramètres utilisateur">
      <div class="sidebar-user-avatar">
        <%= current_user.email[0].upcase %>
      </div>
      <div class="sidebar-user-info">
        <div class="sidebar-user-name"><%= current_user.first_name || current_user.email.split('@').first %></div>
        <div class="sidebar-user-role"><%= current_user.is_admin? ? 'Administrateur' : 'Client' %></div>
      </div>
    </div>
    <div class="sidebar-logout-link">
      <%= link_to "Déconnexion", admin_logout_path, data: { turbo_method: :delete }, style: "display: block; text-align: center; margin-top: 12px; color: var(--text-muted); font-size: 13px; text-decoration: none; transition: all 0.2s; padding: 8px; border-radius: var(--radius-md); font-weight: 600;" %>
    </div>
  </div>
</div>

<% unless current_user.is_admin? %>
  <div class="mobile-bottom-nav">
    <div class="mobile-bottom-nav-content">
      <%= link_to admin_dashboard_path, class: "mobile-nav-item #{request.path == admin_dashboard_path ? 'active' : ''}" do %>
        <div class="mobile-nav-icon"><i class="fa-icon fa-md fa-tachometer-alt"></i></div>
        <div class="mobile-nav-label">Tableau</div>
      <% end %>
      <%= link_to admin_shop_index_path, class: "mobile-nav-item #{request.path.start_with?('/admin/shop') ? 'active' : ''}" do %>
        <div class="mobile-nav-icon"><i class="fa-icon fa-md fa-shopping-cart"></i></div>
        <div class="mobile-nav-label">Boutique</div>
      <% end %>
      <%= link_to admin_my_bots_path, class: "mobile-nav-item #{request.path.start_with?('/admin/my_bots') ? 'active' : ''}" do %>
        <div class="mobile-nav-icon"><i class="fa-icon fa-md fa-robot"></i></div>
        <div class="mobile-nav-label">Mes Bots</div>
      <% end %>
      <%= link_to admin_vps_path, class: "mobile-nav-item #{request.path.start_with?('/admin/vps') ? 'active' : ''}" do %>
        <div class="mobile-nav-icon"><i class="fa-icon fa-md fa-desktop"></i></div>
        <div class="mobile-nav-label">VPS</div>
      <% end %>
      <a href="#" class="mobile-nav-item" onclick="toggleMobileSidebar(); return false;">
        <div class="mobile-nav-icon"><i class="fa-icon fa-md fa-bars"></i></div>
        <div class="mobile-nav-label">Menu</div>
      </a>
    </div>
  </div>
<% else %>
  <!-- Mobile bottom navigation for admins -->
  <div class="mobile-bottom-nav">
    <div class="mobile-bottom-nav-content">
      <%= link_to admin_clients_path, class: "mobile-nav-item #{request.path == admin_clients_path ? 'active' : ''}" do %>
        <div class="mobile-nav-icon"><i class="fa-icon fa-md fa-users"></i></div>
        <div class="mobile-nav-label">Clients</div>
      <% end %>
      <%= link_to admin_bots_path, class: "mobile-nav-item #{request.path.start_with?('/admin/bots') ? 'active' : ''}" do %>
        <div class="mobile-nav-icon"><i class="fa-icon fa-md fa-robot"></i></div>
        <div class="mobile-nav-label">Bots</div>
      <% end %>
      <%= link_to admin_payments_path, class: "mobile-nav-item #{request.path == admin_payments_path ? 'active' : ''}" do %>
        <div class="mobile-nav-icon"><i class="fa-icon fa-md fa-credit-card"></i></div>
        <div class="mobile-nav-label">Paiements</div>
      <% end %>
      <%= link_to admin_shop_index_path, class: "mobile-nav-item #{request.path.start_with?('/admin/shop') ? 'active' : ''}" do %>
        <div class="mobile-nav-icon"><i class="fa-icon fa-md fa-shopping-cart"></i></div>
        <div class="mobile-nav-label">Boutique</div>
      <% end %>
      <a href="#" class="mobile-nav-item" onclick="toggleMobileSidebar(); return false;">
        <div class="mobile-nav-icon"><i class="fa-icon fa-md fa-bars"></i></div>
        <div class="mobile-nav-label">Plus</div>
      </a>
    </div>
  </div>
<% end %>

<script>
  function toggleSidebarCollapse() {
    const sidebar = document.getElementById('mainSidebar');
    const toggleBtn = document.getElementById('sidebarToggleBtn');
    const isCollapsed = sidebar.classList.toggle('collapsed');
    
    toggleBtn.innerHTML = isCollapsed ? '<span class="material-icons md-18">chevron_right</span>' : '<i class="fa-icon fa-md fa-chevron-left"></i>';
    toggleBtn.title = isCollapsed ? 'Agrandir la barre latérale' : 'Réduire la barre latérale';
    
    localStorage.setItem('sidebarCollapsed', isCollapsed ? 'true' : 'false');
    document.documentElement.classList.toggle('sidebar-collapsed-init', isCollapsed);
  }
  
  function toggleMobileSidebar() {
    const sidebar = document.getElementById('mainSidebar');
    const overlay = document.getElementById('sidebarOverlay');
    sidebar.classList.toggle('open');
    overlay.classList.toggle('active');
    document.body.style.overflow = sidebar.classList.contains('open') ? 'hidden' : '';
  }

  function openUserSettings() {
    // Pour l'instant, rediriger vers le profil utilisateur
    // Plus tard, on pourra implémenter une modal de paramètres
    window.location.href = '<%= admin_client_path(current_user) %>';
  }

  (function() {
    const sidebar = document.getElementById('mainSidebar');
    const toggleBtn = document.getElementById('sidebarToggleBtn');
    const isCollapsed = localStorage.getItem('sidebarCollapsed') === 'true';
    
    if (isCollapsed && sidebar && toggleBtn && window.innerWidth > 768) {
      sidebar.classList.add('collapsed');
      toggleBtn.innerHTML = '<span class="material-icons md-18">chevron_right</span>';
      toggleBtn.title = 'Agrandir la barre latérale';
    }
  })();
</script>

