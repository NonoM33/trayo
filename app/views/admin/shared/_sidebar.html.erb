<div class="hidden md:flex h-full flex-col relative shrink-0" data-controller="sidebar" data-sidebar-storage-key-value="trayoSidebar" style="height: 100vh;">
  <div class="relative z-0 flex h-full">
    <div class="relative flex h-full flex-row">
      <details class="w-13 open:w-64 group/sidebar relative z-20 h-full shrink-0 overflow-hidden border-r border-neutral-200 bg-neutral-50 max-md:hidden motion-safe:transition-all motion-safe:duration-300 dark:border-neutral-800 dark:bg-neutral-900" data-sidebar-target="desktopSidebar" style="height: 100vh;">
        <!-- Tiny Sidebar (shown when closed) -->
        <summary class="group-open/sidebar:hidden flex min-h-screen h-full cursor-e-resize list-none flex-col items-start pl-2 pr-1.5">
          <div class="flex h-13 w-full items-center justify-start">
            <button class="cursor-e-resize flex size-10 items-center justify-center rounded-lg text-neutral-500 hover:bg-neutral-100 focus:outline-none focus-visible:bg-neutral-100 disabled:opacity-50 sm:size-9 dark:text-neutral-400 hover:text-neutral-700 dark:hover:text-neutral-100 dark:hover:bg-neutral-800 focus-visible:dark:bg-neutral-800" data-action="click->sidebar#open">
              <i class="fa-solid fa-bars"></i>
            </button>
          </div>

          <div class="mt-1.5 sm:mt-2 flex w-full flex-col items-start gap-1 overflow-y-auto">
            <%= link_to admin_dashboard_path, class: "relative flex h-8 w-8.5 items-center justify-center rounded-lg text-neutral-700 hover:bg-neutral-100 focus:outline-none focus-visible:bg-neutral-100 disabled:opacity-50 dark:text-neutral-100 hover:text-neutral-700 dark:hover:text-neutral-100 dark:hover:bg-neutral-800 focus-visible:dark:bg-neutral-800", title: "Tableau de Bord" do %>
              <i class="fa-solid fa-chart-line"></i>
            <% end %>
            
            <% if current_user.is_admin? %>
              <%= link_to admin_clients_path, class: "relative flex h-8 w-8.5 items-center justify-center rounded-lg text-neutral-700 hover:bg-neutral-100 focus:outline-none focus-visible:bg-neutral-100 disabled:opacity-50 dark:text-neutral-100 hover:text-neutral-700 dark:hover:text-neutral-100 dark:hover:bg-neutral-800 focus-visible:dark:bg-neutral-800", title: "Clients" do %>
                <i class="fa-solid fa-users"></i>
              <% end %>
              <%= link_to admin_shop_index_path, class: "relative flex h-8 w-8.5 items-center justify-center rounded-lg text-emerald-400 hover:bg-emerald-500/20 focus:outline-none focus-visible:bg-emerald-500/20", title: "Boutique" do %>
                <i class="fa-solid fa-store"></i>
              <% end %>
              <%= link_to admin_bots_path, class: "relative flex h-8 w-8.5 items-center justify-center rounded-lg text-neutral-700 hover:bg-neutral-100 focus:outline-none focus-visible:bg-neutral-100 disabled:opacity-50 dark:text-neutral-100 hover:text-neutral-700 dark:hover:text-neutral-100 dark:hover:bg-neutral-800 focus-visible:dark:bg-neutral-800", title: "Bots Trading" do %>
                <i class="fa-solid fa-robot"></i>
              <% end %>
              <%= link_to admin_vps_path, class: "relative flex h-8 w-8.5 items-center justify-center rounded-lg text-neutral-700 hover:bg-neutral-100 focus:outline-none focus-visible:bg-neutral-100 disabled:opacity-50 dark:text-neutral-100 hover:text-neutral-700 dark:hover:text-neutral-100 dark:hover:bg-neutral-800 focus-visible:dark:bg-neutral-800", title: "VPS" do %>
                <i class="fa-solid fa-server"></i>
              <% end %>
              <%= link_to admin_sms_campaigns_path, class: "relative flex h-8 w-8.5 items-center justify-center rounded-lg text-neutral-700 hover:bg-neutral-100 focus:outline-none focus-visible:bg-neutral-100 disabled:opacity-50 dark:text-neutral-100 hover:text-neutral-700 dark:hover:text-neutral-100 dark:hover:bg-neutral-800 focus-visible:dark:bg-neutral-800", title: "Campagnes" do %>
                <i class="fa-solid fa-bullhorn"></i>
              <% end %>
              <%= link_to admin_finance_path, class: "relative flex h-8 w-8.5 items-center justify-center rounded-lg text-neutral-700 hover:bg-neutral-100 focus:outline-none focus-visible:bg-neutral-100 disabled:opacity-50 dark:text-neutral-100 hover:text-neutral-700 dark:hover:text-neutral-100 dark:hover:bg-neutral-800 focus-visible:dark:bg-neutral-800", title: "Finance" do %>
                <i class="fa-solid fa-wallet"></i>
              <% end %>
              <%= link_to admin_trading_path, class: "relative flex h-8 w-8.5 items-center justify-center rounded-lg text-neutral-700 hover:bg-neutral-100 focus:outline-none focus-visible:bg-neutral-100 disabled:opacity-50 dark:text-neutral-100 hover:text-neutral-700 dark:hover:text-neutral-100 dark:hover:bg-neutral-800 focus-visible:dark:bg-neutral-800", title: "Trading" do %>
                <i class="fa-solid fa-chart-candlestick"></i>
              <% end %>
              <%= link_to admin_support_path, class: "relative flex h-8 w-8.5 items-center justify-center rounded-lg text-neutral-700 hover:bg-neutral-100 focus:outline-none focus-visible:bg-neutral-100 disabled:opacity-50 dark:text-neutral-100 hover:text-neutral-700 dark:hover:text-neutral-100 dark:hover:bg-neutral-800 focus-visible:dark:bg-neutral-800", title: "Support" do %>
                <i class="fa-solid fa-headset"></i>
                <% unread_count = SupportTicket.unread.count %>
                <% if unread_count > 0 %>
                  <span class="absolute -top-1 -right-1 bg-red-500 text-white text-[10px] font-bold px-1 rounded-full min-w-[16px] text-center"><%= unread_count %></span>
                <% end %>
              <% end %>
              <%= link_to admin_settings_path, class: "relative flex h-8 w-8.5 items-center justify-center rounded-lg text-neutral-700 hover:bg-neutral-100 focus:outline-none focus-visible:bg-neutral-100 disabled:opacity-50 dark:text-neutral-100 hover:text-neutral-700 dark:hover:text-neutral-100 dark:hover:bg-neutral-800 focus-visible:dark:bg-neutral-800", title: "Configuration" do %>
                <i class="fa-solid fa-cog"></i>
              <% end %>
            <% else %>
              <%= link_to admin_client_path(current_user), class: "relative flex h-8 w-8.5 items-center justify-center rounded-lg text-neutral-700 hover:bg-neutral-100 focus:outline-none focus-visible:bg-neutral-100 disabled:opacity-50 dark:text-neutral-100 hover:text-neutral-700 dark:hover:text-neutral-100 dark:hover:bg-neutral-800 focus-visible:dark:bg-neutral-800", title: "Mon Profil" do %>
                <i class="fa-solid fa-user"></i>
              <% end %>
              <%= link_to admin_shop_index_path, class: "relative flex h-8 w-8.5 items-center justify-center rounded-lg bg-gradient-to-r from-emerald-500/20 to-teal-500/20 text-emerald-400 hover:from-emerald-500/30 hover:to-teal-500/30 focus:outline-none focus-visible:from-emerald-500/30 focus-visible:to-teal-500/30 ring-1 ring-emerald-500/30", title: "Boutique" do %>
                <i class="fa-solid fa-shopping-cart"></i>
                <span class="absolute -top-1 -right-1 flex h-4 w-4 items-center justify-center">
                  <span class="absolute inline-flex h-full w-full animate-ping rounded-full bg-emerald-400 opacity-75"></span>
                  <span class="relative inline-flex h-3 w-3 rounded-full bg-emerald-500"></span>
                </span>
              <% end %>
              <%= link_to admin_my_bots_path, class: "relative flex h-8 w-8.5 items-center justify-center rounded-lg text-neutral-700 hover:bg-neutral-100 focus:outline-none focus-visible:bg-neutral-100 disabled:opacity-50 dark:text-neutral-100 hover:text-neutral-700 dark:hover:text-neutral-100 dark:hover:bg-neutral-800 focus-visible:dark:bg-neutral-800", title: "Mes Bots" do %>
                <i class="fa-solid fa-robot"></i>
              <% end %>
              <%= link_to admin_my_trades_path, class: "relative flex h-8 w-8.5 items-center justify-center rounded-lg text-neutral-700 hover:bg-neutral-100 focus:outline-none focus-visible:bg-neutral-100 disabled:opacity-50 dark:text-neutral-100 hover:text-neutral-700 dark:hover:text-neutral-100 dark:hover:bg-neutral-800 focus-visible:dark:bg-neutral-800", title: "Mes Trades" do %>
                <i class="fa-solid fa-chart-line"></i>
              <% end %>
              <%= link_to admin_vps_path, class: "relative flex h-8 w-8.5 items-center justify-center rounded-lg text-neutral-700 hover:bg-neutral-100 focus:outline-none focus-visible:bg-neutral-100 disabled:opacity-50 dark:text-neutral-100 hover:text-neutral-700 dark:hover:text-neutral-100 dark:hover:bg-neutral-800 focus-visible:dark:bg-neutral-800", title: "Mes VPS" do %>
                <i class="fa-solid fa-server"></i>
              <% end %>
            <% end %>
          </div>

          <div class="flex-grow"></div>

          <div class="py-1 sm:py-1.5 flex items-start justify-center">
            <%= link_to admin_client_path(current_user), class: "flex mb-1 h-8 w-9 items-center justify-center rounded-lg text-neutral-700 hover:bg-neutral-100 focus:outline-none focus-visible:bg-neutral-100 disabled:opacity-50 dark:text-neutral-100 hover:text-neutral-700 dark:hover:text-neutral-100 dark:hover:bg-neutral-800 focus-visible:dark:bg-neutral-800", title: "Profil" do %>
              <div class="size-6 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white font-semibold text-xs">
                <%= current_user.email[0].upcase %>
              </div>
            <% end %>
          </div>
        </summary>

        <!-- Full Sidebar (shown when open) -->
        <div class="h-full w-64 overflow-x-clip overflow-y-auto bg-neutral-50 text-clip whitespace-nowrap dark:bg-neutral-900" data-sidebar-target="desktopContent">
          <!-- Shared Sidebar Content Template -->
          <template data-sidebar-target="contentTemplate">
            <nav class="min-h-screen relative flex h-full w-full flex-1 flex-col overflow-y-auto select-none">
            <div class="sticky top-0 z-30 bg-neutral-50 dark:bg-neutral-900 border-b border-neutral-200 dark:border-neutral-800">
              <div class="px-1.5 sm:px-2">
                <div class="flex h-13 items-center justify-between">
                  <%= link_to admin_dashboard_path, class: "flex size-10 items-center justify-center rounded-lg text-neutral-900 hover:bg-neutral-100 focus:outline-none focus-visible:bg-neutral-100 disabled:opacity-50 sm:size-9 dark:text-neutral-100 dark:hover:bg-neutral-800 focus-visible:dark:bg-neutral-800" do %>
                    <div class="size-8 rounded-lg bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white font-bold text-lg">
                      T
                    </div>
                  <% end %>
                  <div class="flex">
                    <button class="flex size-10 cursor-w-resize items-center justify-center rounded-lg text-neutral-500 hover:bg-neutral-100 focus:outline-none focus-visible:bg-neutral-100 disabled:opacity-50 sm:size-9 dark:text-neutral-400 hover:text-neutral-700 dark:hover:text-neutral-100 dark:hover:bg-neutral-800 focus-visible:dark:bg-neutral-800" aria-expanded="true" aria-label="Close sidebar" data-state="closed" data-action="click->sidebar#close">
                      <i class="fa-solid fa-chevron-left"></i>
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <aside class="relative bg-neutral-50 p-1.5 last:mb-5 sm:p-2 dark:bg-neutral-900">
              <% if current_user.is_admin? %>
                <div class="space-y-0.5">
                  <%# Dashboard %>
                  <%= link_to admin_dashboard_path, class: "group w-full flex items-center gap-2 rounded-lg px-3 py-2 text-sm transition-colors #{request.path == admin_dashboard_path ? 'bg-blue-600 text-white' : 'text-neutral-400 hover:bg-neutral-800 hover:text-white'}" do %>
                    <i class="fa-solid fa-chart-line w-5"></i>
                    <span>Dashboard</span>
                  <% end %>
                  
                  <%# Clients %>
                  <%= link_to admin_clients_path, class: "group w-full flex items-center gap-2 rounded-lg px-3 py-2 text-sm transition-colors #{request.path.start_with?('/admin/clients') ? 'bg-blue-600 text-white' : 'text-neutral-400 hover:bg-neutral-800 hover:text-white'}" do %>
                    <i class="fa-solid fa-users w-5"></i>
                    <span>Clients</span>
                  <% end %>
                  
                  <%# Boutique %>
                  <%= link_to admin_shop_index_path, class: "group w-full flex items-center justify-between gap-2 rounded-lg px-3 py-2 text-sm transition-colors #{request.path.start_with?('/admin/shop') ? 'bg-emerald-600 text-white' : 'text-emerald-400 hover:bg-emerald-500/10 hover:text-emerald-300'}" do %>
                    <div class="flex items-center gap-2">
                      <i class="fa-solid fa-store w-5"></i>
                      <span>Boutique</span>
                    </div>
                  <% end %>
                  
                  <%# Bots %>
                  <%= link_to admin_bots_path, class: "group w-full flex items-center gap-2 rounded-lg px-3 py-2 text-sm transition-colors #{request.path.start_with?('/admin/bots') ? 'bg-blue-600 text-white' : 'text-neutral-400 hover:bg-neutral-800 hover:text-white'}" do %>
                    <i class="fa-solid fa-robot w-5"></i>
                    <span>Bots</span>
                  <% end %>
                  
                  <%# VPS %>
                  <%= link_to admin_vps_path, class: "group w-full flex items-center gap-2 rounded-lg px-3 py-2 text-sm transition-colors #{request.path.start_with?('/admin/vps') ? 'bg-blue-600 text-white' : 'text-neutral-400 hover:bg-neutral-800 hover:text-white'}" do %>
                    <i class="fa-solid fa-server w-5"></i>
                    <span>VPS</span>
                  <% end %>
                  
                  <%# Campagnes %>
                  <%= link_to admin_sms_campaigns_path, class: "group w-full flex items-center gap-2 rounded-lg px-3 py-2 text-sm transition-colors #{request.path.start_with?('/admin/sms_campaigns') ? 'bg-blue-600 text-white' : 'text-neutral-400 hover:bg-neutral-800 hover:text-white'}" do %>
                    <i class="fa-solid fa-bullhorn w-5"></i>
                    <span>Campagnes</span>
                  <% end %>
                  
                  <div class="my-2 border-t border-neutral-800"></div>
                  
                  <%# Finance %>
                  <%= link_to admin_finance_path, class: "group w-full flex items-center gap-2 rounded-lg px-3 py-2 text-sm transition-colors #{request.path.start_with?('/admin/finance') ? 'bg-blue-600 text-white' : 'text-neutral-400 hover:bg-neutral-800 hover:text-white'}" do %>
                    <i class="fa-solid fa-wallet w-5"></i>
                    <span>Finance</span>
                  <% end %>
                  
                  <%# Trading %>
                  <% pending_defender = Trade.where(trade_originality: 'manual_pending_review').count rescue 0 %>
                  <%= link_to admin_trading_path, class: "group w-full flex items-center justify-between gap-2 rounded-lg px-3 py-2 text-sm transition-colors #{request.path.start_with?('/admin/trading') || request.path.start_with?('/admin/trades') || request.path.start_with?('/admin/trade_defenders') ? 'bg-blue-600 text-white' : 'text-neutral-400 hover:bg-neutral-800 hover:text-white'}" do %>
                    <div class="flex items-center gap-2">
                      <i class="fa-solid fa-chart-candlestick w-5"></i>
                      <span>Trading</span>
                    </div>
                    <% if pending_defender > 0 %>
                      <span class="px-1.5 py-0.5 rounded-full text-[10px] font-bold bg-amber-500 text-white"><%= pending_defender %></span>
                    <% end %>
                  <% end %>
                  
                  <%# Support %>
                  <% unread_tickets = SupportTicket.unread.count rescue 0 %>
                  <%= link_to admin_support_path, class: "group w-full flex items-center justify-between gap-2 rounded-lg px-3 py-2 text-sm transition-colors #{request.path.start_with?('/admin/support') ? 'bg-blue-600 text-white' : 'text-neutral-400 hover:bg-neutral-800 hover:text-white'}" do %>
                    <div class="flex items-center gap-2">
                      <i class="fa-solid fa-headset w-5"></i>
                      <span>Support</span>
                    </div>
                    <% if unread_tickets > 0 %>
                      <span class="px-1.5 py-0.5 rounded-full text-[10px] font-bold bg-red-500 text-white"><%= unread_tickets %></span>
                    <% end %>
                  <% end %>
                  
                  <div class="my-2 border-t border-neutral-800"></div>
                  
                  <%# Configuration %>
                  <%= link_to admin_settings_path, class: "group w-full flex items-center gap-2 rounded-lg px-3 py-2 text-sm transition-colors #{request.path.start_with?('/admin/settings') || request.path.start_with?('/admin/maintenance') || request.path.start_with?('/admin/backups') ? 'bg-blue-600 text-white' : 'text-neutral-400 hover:bg-neutral-800 hover:text-white'}" do %>
                    <i class="fa-solid fa-cog w-5"></i>
                    <span>Configuration</span>
                  <% end %>
                </div>
              <% else %>
                <div class="space-y-0.5">
                  <%= link_to admin_dashboard_path, class: "group w-full flex items-center gap-2 rounded-lg px-3 py-2 text-sm transition-colors #{request.path == admin_dashboard_path ? 'bg-blue-600 text-white' : 'text-neutral-400 hover:bg-neutral-800 hover:text-white'}" do %>
                    <i class="fa-solid fa-chart-line w-5"></i>
                    <span>Dashboard</span>
                  <% end %>
                  
                  <%= link_to admin_client_path(current_user), class: "group w-full flex items-center gap-2 rounded-lg px-3 py-2 text-sm transition-colors #{request.path == admin_client_path(current_user) ? 'bg-blue-600 text-white' : 'text-neutral-400 hover:bg-neutral-800 hover:text-white'}" do %>
                    <i class="fa-solid fa-user w-5"></i>
                    <span>Mon Profil</span>
                  <% end %>
                  
                  <div class="my-2 border-t border-neutral-800"></div>
                  
                  <%= link_to admin_shop_index_path, class: "group w-full flex items-center justify-between gap-2 rounded-lg px-3 py-2.5 text-sm transition-all #{request.path.start_with?('/admin/shop') ? 'bg-gradient-to-r from-emerald-600 to-teal-600 text-white shadow-lg shadow-emerald-500/25' : 'bg-gradient-to-r from-emerald-500/10 to-teal-500/10 text-emerald-400 hover:from-emerald-500/20 hover:to-teal-500/20 ring-1 ring-emerald-500/20'}" do %>
                    <div class="flex items-center gap-2">
                      <i class="fa-solid fa-shopping-cart w-5"></i>
                      <span class="font-semibold">Boutique</span>
                    </div>
                    <span class="px-2 py-0.5 rounded-full text-[10px] font-bold bg-emerald-500 text-white animate-pulse">NEW</span>
                  <% end %>
                  
                  <%= link_to admin_my_bots_path, class: "group w-full flex items-center gap-2 rounded-lg px-3 py-2 text-sm transition-colors #{request.path.start_with?('/admin/my_bots') ? 'bg-blue-600 text-white' : 'text-neutral-400 hover:bg-neutral-800 hover:text-white'}" do %>
                    <i class="fa-solid fa-robot w-5"></i>
                    <span>Mes Bots</span>
                  <% end %>
                  
                  <%= link_to admin_my_trades_path, class: "group w-full flex items-center gap-2 rounded-lg px-3 py-2 text-sm transition-colors #{request.path.start_with?('/admin/my_trades') ? 'bg-blue-600 text-white' : 'text-neutral-400 hover:bg-neutral-800 hover:text-white'}" do %>
                    <i class="fa-solid fa-chart-line w-5"></i>
                    <span>Mes Trades</span>
                  <% end %>
                  
                  <%= link_to admin_vps_path, class: "group w-full flex items-center gap-2 rounded-lg px-3 py-2 text-sm transition-colors #{request.path.start_with?('/admin/vps') ? 'bg-blue-600 text-white' : 'text-neutral-400 hover:bg-neutral-800 hover:text-white'}" do %>
                    <i class="fa-solid fa-server w-5"></i>
                    <span>Mes VPS</span>
                  <% end %>
                  
                  <%= link_to admin_my_invoices_path, class: "group w-full flex items-center gap-2 rounded-lg px-3 py-2 text-sm transition-colors #{request.path.start_with?('/admin/my_invoices') ? 'bg-blue-600 text-white' : 'text-neutral-400 hover:bg-neutral-800 hover:text-white'}" do %>
                    <i class="fa-solid fa-file-invoice w-5"></i>
                    <span>Mes Factures</span>
                  <% end %>
                </div>
              <% end %>
            </aside>

            <div class="grow"></div>

            <div class="sticky bottom-0 z-30 bg-neutral-50 p-1.5 empty:hidden sm:p-2 dark:bg-neutral-900 border-t border-neutral-200 dark:border-neutral-800">
              <%= link_to admin_client_path(current_user), class: "w-full flex items-center gap-2 rounded-md px-1 sm:px-1.5 py-1 sm:py-1.5 text-left text-sm text-neutral-700 hover:bg-neutral-100 focus-visible:bg-neutral-100 focus:outline-hidden disabled:cursor-not-allowed disabled:opacity-50 dark:text-neutral-100 dark:hover:bg-neutral-700/50 dark:focus-visible:bg-neutral-700/50" do %>
                <div class="flex items-center justify-center group-disabled:opacity-50 group-data-disabled:opacity-50">
                  <div class="flex h-6 w-6 shrink-0 overflow-hidden rounded-full bg-gradient-to-br from-blue-500 to-purple-600">
                    <div class="h-6 w-6 flex items-center justify-center text-white font-semibold text-xs">
                      <%= current_user.email[0].upcase %>
                    </div>
                  </div>
                </div>
                <div class="min-w-0">
                  <div class="flex min-w-0 grow items-center gap-2.5 group-data-no-contents-gap:gap-0">
                    <div class="truncate text-xs"><%= current_user.first_name || current_user.email.split('@').first %></div>
                  </div>
                  <div class="truncate text-xs text-neutral-500 dark:text-neutral-400"><%= current_user.is_admin? ? 'Administrateur' : 'Client' %></div>
                </div>
              <% end %>
              <%= link_to admin_logout_path, data: { turbo_method: :delete }, class: "w-full mt-2 flex items-center justify-center gap-2 rounded-md px-1 sm:px-1.5 py-1 sm:py-1.5 text-left text-sm text-red-600 hover:bg-red-50 focus-visible:bg-red-50 focus:outline-hidden disabled:cursor-not-allowed disabled:opacity-50 dark:text-red-400 dark:hover:bg-red-900/20 dark:focus-visible:bg-red-900/20" do %>
                <i class="fa-solid fa-sign-out-alt"></i>
                <span class="text-xs">DÃ©connexion</span>
              <% end %>
            </div>
          </nav>
          </template>
        </div>
      </details>
    </div>

  </div>
</div>

<script>
  (function() {
    const sidebar = document.querySelector('[data-controller="sidebar"]');
    if (sidebar) {
      const template = sidebar.querySelector('[data-sidebar-target="contentTemplate"]');
      const sharedContent = sidebar.querySelector('[data-sidebar-target="sharedContent"]');
      const desktopContent = sidebar.querySelector('[data-sidebar-target="desktopContent"]');
      
      if (template && sharedContent) {
        sharedContent.innerHTML = template.innerHTML;
      }
      
      if (template && desktopContent) {
        desktopContent.innerHTML = template.innerHTML;
      }
    }
  })();
</script>
