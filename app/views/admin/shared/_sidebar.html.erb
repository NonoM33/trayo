<div class="sidebar-mobile-overlay" id="sidebarOverlay" onclick="toggleMobileSidebar()"></div>

<div class="sidebar" id="mainSidebar">
  <div class="sidebar-header">
    <div class="sidebar-logo">
      <div class="sidebar-logo-icon" onclick="toggleSidebarCollapse()" title="RÃ©duire/Agrandir la barre latÃ©rale">T</div>
      <span><%= current_user.is_admin? ? 'Trayo Admin' : 'Trayo' %></span>
    </div>
    <button class="sidebar-toggle-btn" onclick="toggleSidebarCollapse()" id="sidebarToggleBtn" title="RÃ©duire la barre latÃ©rale">
      â†
    </button>
  </div>
  
  <nav class="sidebar-nav">
    <div class="sidebar-section">
      <div class="sidebar-section-title">Principal</div>
      <ul class="sidebar-menu">
        <% if current_user.is_admin? %>
          <li class="sidebar-menu-item">
            <%= link_to admin_clients_path, class: "sidebar-menu-link #{request.path == admin_clients_path ? 'active' : ''}" do %>
              <span class="sidebar-menu-icon">ğŸ‘¥</span>
              <span>Clients</span>
            <% end %>
          </li>
          <li class="sidebar-menu-item">
            <%= link_to admin_bots_path, class: "sidebar-menu-link #{request.path.start_with?('/admin/bots') ? 'active' : ''}" do %>
              <span class="sidebar-menu-icon">ğŸ¤–</span>
              <span>Bots Trading</span>
            <% end %>
          </li>
          <li class="sidebar-menu-item">
            <%= link_to admin_payments_path, class: "sidebar-menu-link #{request.path == admin_payments_path ? 'active' : ''}" do %>
              <span class="sidebar-menu-icon">ğŸ’°</span>
              <span>Paiements</span>
            <% end %>
          </li>
          <li class="sidebar-menu-item">
            <%= link_to admin_credits_path, class: "sidebar-menu-link #{request.path == admin_credits_path ? 'active' : ''}" do %>
              <span class="sidebar-menu-icon">ğŸ«</span>
              <span>CrÃ©dits</span>
            <% end %>
          </li>
          <li class="sidebar-menu-item">
            <%= link_to admin_bonus_deposits_path, class: "sidebar-menu-link #{request.path.start_with?('/admin/bonus_deposit') ? 'active' : ''}" do %>
              <span class="sidebar-menu-icon">ğŸ</span>
              <span>DÃ©pÃ´ts Bonus</span>
            <% end %>
          </li>
          <li class="sidebar-menu-item">
            <%= link_to admin_bonus_periods_path, class: "sidebar-menu-link #{request.path.start_with?('/admin/bonus_period') ? 'active' : ''}" do %>
              <span class="sidebar-menu-icon">ğŸ“…</span>
              <span>PÃ©riodes Bonus</span>
            <% end %>
          </li>
          <li class="sidebar-menu-item">
            <%= link_to admin_vps_path, class: "sidebar-menu-link #{request.path.start_with?('/admin/vps') ? 'active' : ''}" do %>
              <span class="sidebar-menu-icon">ğŸ–¥ï¸</span>
              <span>VPS</span>
            <% end %>
          </li>
          <li class="sidebar-menu-item">
            <%= link_to admin_campaigns_path, class: "sidebar-menu-link #{request.path.start_with?('/admin/campaigns') ? 'active' : ''}" do %>
              <span class="sidebar-menu-icon">ğŸ¯</span>
              <span>Campagnes</span>
            <% end %>
          </li>
        <% else %>
          <li class="sidebar-menu-item">
            <%= link_to admin_dashboard_path, class: "sidebar-menu-link #{request.path == admin_dashboard_path ? 'active' : ''}" do %>
              <span class="sidebar-menu-icon">ğŸ“Š</span>
              <span>Tableau de Bord</span>
            <% end %>
          </li>
          <li class="sidebar-menu-item">
            <%= link_to admin_client_path(current_user), class: "sidebar-menu-link #{request.path == admin_client_path(current_user) ? 'active' : ''}" do %>
              <span class="sidebar-menu-icon">ğŸ‘¤</span>
              <span>Mon Profil</span>
            <% end %>
          </li>
          <li class="sidebar-menu-item">
            <%= link_to admin_shop_index_path, class: "sidebar-menu-link #{request.path.start_with?('/admin/shop') ? 'active' : ''}" do %>
              <span class="sidebar-menu-icon">ğŸ›’</span>
              <span>Boutique</span>
            <% end %>
          </li>
          <li class="sidebar-menu-item">
            <%= link_to admin_my_bots_path, class: "sidebar-menu-link #{request.path.start_with?('/admin/my_bots') ? 'active' : ''}" do %>
              <span class="sidebar-menu-icon">ğŸ¤–</span>
              <span>Mes Bots</span>
            <% end %>
          </li>
          <li class="sidebar-menu-item">
            <%= link_to admin_bonus_deposits_path, class: "sidebar-menu-link #{request.path.start_with?('/admin/bonus') ? 'active' : ''}" do %>
              <span class="sidebar-menu-icon">ğŸ</span>
              <span>Programme Bonus</span>
            <% end %>
          </li>
          <li class="sidebar-menu-item">
            <%= link_to admin_vps_path, class: "sidebar-menu-link #{request.path.start_with?('/admin/vps') ? 'active' : ''}" do %>
              <span class="sidebar-menu-icon">ğŸ–¥ï¸</span>
              <span>Mes VPS</span>
            <% end %>
          </li>
        <% end %>
      </ul>
    </div>
  </nav>
  
  <div class="sidebar-footer">
    <div class="sidebar-user" onclick="openUserSettings()" title="ParamÃ¨tres utilisateur">
      <div class="sidebar-user-avatar">
        <%= current_user.email[0].upcase %>
      </div>
      <div class="sidebar-user-info">
        <div class="sidebar-user-name"><%= current_user.first_name || current_user.email.split('@').first %></div>
        <div class="sidebar-user-role"><%= current_user.is_admin? ? 'Administrateur' : 'Client' %></div>
      </div>
    </div>
    <div class="sidebar-logout-link">
      <%= link_to "DÃ©connexion", admin_logout_path, data: { turbo_method: :delete }, style: "display: block; text-align: center; margin-top: 12px; color: var(--text-muted); font-size: 13px; text-decoration: none; transition: all 0.2s; padding: 8px; border-radius: var(--radius-md); font-weight: 600;" %>
    </div>
  </div>
</div>

<% unless current_user.is_admin? %>
  <div class="mobile-bottom-nav">
    <div class="mobile-bottom-nav-content">
      <%= link_to admin_dashboard_path, class: "mobile-nav-item #{request.path == admin_dashboard_path ? 'active' : ''}" do %>
        <div class="mobile-nav-icon">ğŸ“Š</div>
        <div class="mobile-nav-label">Tableau</div>
      <% end %>
      <%= link_to admin_shop_index_path, class: "mobile-nav-item #{request.path.start_with?('/admin/shop') ? 'active' : ''}" do %>
        <div class="mobile-nav-icon">ğŸ›’</div>
        <div class="mobile-nav-label">Boutique</div>
      <% end %>
      <%= link_to admin_my_bots_path, class: "mobile-nav-item #{request.path.start_with?('/admin/my_bots') ? 'active' : ''}" do %>
        <div class="mobile-nav-icon">ğŸ¤–</div>
        <div class="mobile-nav-label">Mes Bots</div>
      <% end %>
      <%= link_to admin_vps_path, class: "mobile-nav-item #{request.path.start_with?('/admin/vps') ? 'active' : ''}" do %>
        <div class="mobile-nav-icon">ğŸ–¥ï¸</div>
        <div class="mobile-nav-label">VPS</div>
      <% end %>
      <a href="#" class="mobile-nav-item" onclick="toggleMobileSidebar(); return false;">
        <div class="mobile-nav-icon">â˜°</div>
        <div class="mobile-nav-label">Menu</div>
      </a>
    </div>
  </div>
<% else %>
  <!-- Mobile bottom navigation for admins -->
  <div class="mobile-bottom-nav">
    <div class="mobile-bottom-nav-content">
      <%= link_to admin_clients_path, class: "mobile-nav-item #{request.path == admin_clients_path ? 'active' : ''}" do %>
        <div class="mobile-nav-icon">ğŸ‘¥</div>
        <div class="mobile-nav-label">Clients</div>
      <% end %>
      <%= link_to admin_bots_path, class: "mobile-nav-item #{request.path.start_with?('/admin/bots') ? 'active' : ''}" do %>
        <div class="mobile-nav-icon">ğŸ¤–</div>
        <div class="mobile-nav-label">Bots</div>
      <% end %>
      <%= link_to admin_payments_path, class: "mobile-nav-item #{request.path == admin_payments_path ? 'active' : ''}" do %>
        <div class="mobile-nav-icon">ğŸ’°</div>
        <div class="mobile-nav-label">Paiements</div>
      <% end %>
      <%= link_to admin_shop_index_path, class: "mobile-nav-item #{request.path.start_with?('/admin/shop') ? 'active' : ''}" do %>
        <div class="mobile-nav-icon">ğŸ›’</div>
        <div class="mobile-nav-label">Boutique</div>
      <% end %>
      <a href="#" class="mobile-nav-item" onclick="toggleMobileSidebar(); return false;">
        <div class="mobile-nav-icon">â˜°</div>
        <div class="mobile-nav-label">Plus</div>
      </a>
    </div>
  </div>
<% end %>

<script>
  function toggleSidebarCollapse() {
    const sidebar = document.getElementById('mainSidebar');
    const toggleBtn = document.getElementById('sidebarToggleBtn');
    const isCollapsed = sidebar.classList.toggle('collapsed');
    
    toggleBtn.textContent = isCollapsed ? 'â†’' : 'â†';
    toggleBtn.title = isCollapsed ? 'Agrandir la barre latÃ©rale' : 'RÃ©duire la barre latÃ©rale';
    
    localStorage.setItem('sidebarCollapsed', isCollapsed ? 'true' : 'false');
    document.documentElement.classList.toggle('sidebar-collapsed-init', isCollapsed);
  }
  
  function toggleMobileSidebar() {
    const sidebar = document.getElementById('mainSidebar');
    const overlay = document.getElementById('sidebarOverlay');
    sidebar.classList.toggle('open');
    overlay.classList.toggle('active');
    document.body.style.overflow = sidebar.classList.contains('open') ? 'hidden' : '';
  }

  function openUserSettings() {
    // Pour l'instant, rediriger vers le profil utilisateur
    // Plus tard, on pourra implÃ©menter une modal de paramÃ¨tres
    window.location.href = '<%= admin_client_path(current_user) %>';
  }

  (function() {
    const sidebar = document.getElementById('mainSidebar');
    const toggleBtn = document.getElementById('sidebarToggleBtn');
    const isCollapsed = localStorage.getItem('sidebarCollapsed') === 'true';
    
    if (isCollapsed && sidebar && toggleBtn && window.innerWidth > 768) {
      sidebar.classList.add('collapsed');
      toggleBtn.textContent = 'â†’';
      toggleBtn.title = 'Agrandir la barre latÃ©rale';
    }
  })();
</script>

