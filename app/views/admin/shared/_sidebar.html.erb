<div class="sidebar-mobile-overlay" id="sidebarOverlay" onclick="toggleMobileSidebar()"></div>

<div class="sidebar" id="mainSidebar">
  <div class="sidebar-header">
    <div class="sidebar-logo">
      <div class="sidebar-logo-icon" onclick="toggleSidebarCollapse()" title="Réduire/Agrandir la barre latérale">T</div>
      <span><%= current_user.is_admin? ? 'Trayo Admin' : 'Trayo' %></span>
    </div>
    <button class="sidebar-toggle-btn" onclick="toggleSidebarCollapse()" id="sidebarToggleBtn" title="Réduire la barre latérale">
      <i class="fa-solid fa-chevron-left"></i>
    </button>
  </div>
  
  <nav class="sidebar-nav">
    <div class="sidebar-section">
      <div class="sidebar-section-title">Principal</div>
      <ul class="sidebar-menu">
        <% if current_user.is_admin? %>
          <% Rails.logger.info "=== SIDEBAR DEBUG: Rendering admin sidebar ===" %>
          <li class="sidebar-menu-item">
            <%= link_to admin_dashboard_path, class: "sidebar-menu-link #{request.path == admin_dashboard_path ? 'active' : ''}" do %>
              <% Rails.logger.info "=== SIDEBAR DEBUG: Dashboard icon ===" %>
              <%= nav_icon(:dashboard) %>
              <span>Tableau de Bord</span>
            <% end %>
          </li>
          <li class="sidebar-menu-item">
            <%= link_to admin_clients_path, class: "sidebar-menu-link #{request.path == admin_clients_path ? 'active' : ''}" do %>
              <%= nav_icon(:clients) %>
              <span>Clients</span>
            <% end %>
          </li>
          <li class="sidebar-menu-item">
            <%= link_to admin_bots_path, class: "sidebar-menu-link #{request.path.start_with?('/admin/bots') ? 'active' : ''}" do %>
              <%= nav_icon(:my_bots) %>
              <span>Bots Trading</span>
            <% end %>
          </li>
          <li class="sidebar-menu-item">
            <%= link_to admin_payments_path, class: "sidebar-menu-link #{request.path == admin_payments_path ? 'active' : ''}" do %>
              <%= nav_icon(:payments) %>
              <span>Paiements</span>
            <% end %>
          </li>
          <li class="sidebar-menu-item">
            <%= link_to admin_credits_path, class: "sidebar-menu-link #{request.path == admin_credits_path ? 'active' : ''}" do %>
              <%= nav_icon(:bonus_program) %>
              <span>Crédits</span>
            <% end %>
          </li>
          <li class="sidebar-menu-item">
            <%= link_to admin_bonus_deposits_path, class: "sidebar-menu-link #{request.path.start_with?('/admin/bonus_deposit') ? 'active' : ''}" do %>
              <%= nav_icon(:bonus_program) %>
              <span>Dépôts Bonus</span>
            <% end %>
          </li>
          <li class="sidebar-menu-item">
            <%= link_to admin_bonus_periods_path, class: "sidebar-menu-link #{request.path.start_with?('/admin/bonus_period') ? 'active' : ''}" do %>
              <i class="fa-icon fa-md fa-calendar"></i>
              <span>Périodes Bonus</span>
            <% end %>
          </li>
          <li class="sidebar-menu-item">
            <%= link_to admin_vps_path, class: "sidebar-menu-link #{request.path.start_with?('/admin/vps') ? 'active' : ''}" do %>
              <%= nav_icon(:my_vps) %>
              <span>VPS</span>
            <% end %>
          </li>
          <li class="sidebar-menu-item">
            <%= link_to admin_campaigns_path, class: "sidebar-menu-link #{request.path.start_with?('/admin/campaigns') ? 'active' : ''}" do %>
              <%= nav_icon(:campaigns) %>
              <span>Campagnes</span>
            <% end %>
          </li>
          <li class="sidebar-menu-item">
            <%= link_to admin_invitations_path, class: "sidebar-menu-link #{request.path.start_with?('/admin/invitations') ? 'active' : ''}" do %>
              <i class="fa-icon fa-md fa-ticket-alt"></i>
              <span>Invitations</span>
            <% end %>
          </li>
          <li class="sidebar-menu-item">
            <%= link_to admin_trades_path, class: "sidebar-menu-link #{request.path.start_with?('/admin/trades') ? 'active' : ''}" do %>
              <%= nav_icon(:trades) %>
              <span>Trades</span>
            <% end %>
          </li>
          <li class="sidebar-menu-item">
            <%= link_to admin_trade_defenders_path, class: "sidebar-menu-link #{request.path.start_with?('/admin/trade_defenders') ? 'active' : ''}" do %>
              <i class="fa-icon fa-md fa-shield-alt"></i>
              <span>Trade Defender</span>
            <% end %>
          </li>
          <li class="sidebar-menu-item">
            <%= link_to admin_withdrawals_path, class: "sidebar-menu-link #{request.path.start_with?('/admin/withdrawals') ? 'active' : ''}" do %>
              <%= nav_icon(:withdrawals) %>
              <span>Retraits</span>
            <% end %>
          </li>
          <li class="sidebar-menu-item">
            <%= link_to admin_deposits_path, class: "sidebar-menu-link #{request.path.start_with?('/admin/deposits') ? 'active' : ''}" do %>
              <%= nav_icon(:deposits) %>
              <span>Dépôts</span>
            <% end %>
          </li>
          <li class="sidebar-menu-item">
            <%= link_to admin_mt5_tokens_path, class: "sidebar-menu-link #{request.path.start_with?('/admin/mt5_tokens') ? 'active' : ''}" do %>
              <%= nav_icon(:mt5_tokens) %>
              <span>Tokens MT5</span>
            <% end %>
          </li>
          <li class="sidebar-menu-item">
            <%= link_to admin_maintenance_path, class: "sidebar-menu-link #{request.path.start_with?('/admin/maintenance') ? 'active' : ''}" do %>
              <%= nav_icon(:maintenance) %>
              <span>Maintenance</span>
            <% end %>
          </li>
        <% else %>
          <% Rails.logger.info "=== SIDEBAR DEBUG: Rendering non-admin sidebar ===" %>
          <li class="sidebar-menu-item">
            <%= link_to admin_dashboard_path, class: "sidebar-menu-link #{request.path == admin_dashboard_path ? 'active' : ''}" do %>
              <% Rails.logger.info "=== SIDEBAR DEBUG: Non-admin Dashboard icon ===" %>
              <%= nav_icon(:dashboard) %>
              <span>Tableau de Bord</span>
            <% end %>
          </li>
          <li class="sidebar-menu-item">
            <%= link_to admin_client_path(current_user), class: "sidebar-menu-link #{request.path == admin_client_path(current_user) ? 'active' : ''}" do %>
              <%= nav_icon(:profile) %>
              <span>Mon Profil</span>
            <% end %>
          </li>
          <li class="sidebar-menu-item">
            <%= link_to admin_shop_index_path, class: "sidebar-menu-link #{request.path.start_with?('/admin/shop') ? 'active' : ''}" do %>
              <%= nav_icon(:shop) %>
              <span>Boutique</span>
            <% end %>
          </li>
          <li class="sidebar-menu-item">
            <%= link_to admin_my_bots_path, class: "sidebar-menu-link #{request.path.start_with?('/admin/my_bots') ? 'active' : ''}" do %>
              <%= nav_icon(:my_bots) %>
              <span>Mes Bots</span>
            <% end %>
          </li>
          <li class="sidebar-menu-item">
            <%= link_to admin_my_trades_path, class: "sidebar-menu-link #{request.path.start_with?('/admin/my_trades') ? 'active' : ''}" do %>
              <%= nav_icon(:my_trades) %>
              <span>Mes Trades</span>
            <% end %>
          </li>
          <li class="sidebar-menu-item">
            <%= link_to admin_bonus_deposits_path, class: "sidebar-menu-link #{request.path.start_with?('/admin/bonus') ? 'active' : ''}" do %>
              <%= nav_icon(:bonus_program) %>
              <span>Programme Bonus</span>
            <% end %>
          </li>
          <li class="sidebar-menu-item">
            <%= link_to admin_vps_path, class: "sidebar-menu-link #{request.path.start_with?('/admin/vps') ? 'active' : ''}" do %>
              <%= nav_icon(:my_vps) %>
              <span>Mes VPS</span>
            <% end %>
          </li>
        <% end %>
      </ul>
    </div>
  </nav>
  
  <div class="sidebar-footer">
    <div class="sidebar-user" onclick="openUserSettings()" title="Paramètres utilisateur">
      <div class="sidebar-user-avatar">
        <%= current_user.email[0].upcase %>
      </div>
      <div class="sidebar-user-info">
        <div class="sidebar-user-name"><%= current_user.first_name || current_user.email.split('@').first %></div>
        <div class="sidebar-user-role"><%= current_user.is_admin? ? 'Administrateur' : 'Client' %></div>
      </div>
    </div>
    <div class="sidebar-logout-link">
      <%= link_to "Déconnexion", admin_logout_path, data: { turbo_method: :delete }, style: "display: block; text-align: center; margin-top: 12px; color: var(--text-muted); font-size: 13px; text-decoration: none; transition: all 0.2s; padding: 8px; border-radius: var(--radius-md); font-weight: 600;" %>
    </div>
  </div>
</div>

<% unless current_user.is_admin? %>
  <div class="mobile-bottom-nav">
    <div class="mobile-bottom-nav-content">
      <%= link_to admin_dashboard_path, class: "mobile-nav-item #{request.path == admin_dashboard_path ? 'active' : ''}" do %>
        <div class="mobile-nav-icon"><i class="fa-icon fa-md fa-tachometer-alt"></i></div>
        <div class="mobile-nav-label">Tableau</div>
      <% end %>
      <%= link_to admin_shop_index_path, class: "mobile-nav-item #{request.path.start_with?('/admin/shop') ? 'active' : ''}" do %>
        <div class="mobile-nav-icon"><i class="fa-icon fa-md fa-shopping-cart"></i></div>
        <div class="mobile-nav-label">Boutique</div>
      <% end %>
      <%= link_to admin_my_bots_path, class: "mobile-nav-item #{request.path.start_with?('/admin/my_bots') ? 'active' : ''}" do %>
        <div class="mobile-nav-icon"><i class="fa-icon fa-md fa-robot"></i></div>
        <div class="mobile-nav-label">Mes Bots</div>
      <% end %>
      <%= link_to admin_my_trades_path, class: "mobile-nav-item #{request.path.start_with?('/admin/my_trades') ? 'active' : ''}" do %>
        <div class="mobile-nav-icon"><i class="fa-icon fa-md fa-chart-line"></i></div>
        <div class="mobile-nav-label">Mes Trades</div>
      <% end %>
      <%= link_to admin_vps_path, class: "mobile-nav-item #{request.path.start_with?('/admin/vps') ? 'active' : ''}" do %>
        <div class="mobile-nav-icon"><i class="fa-icon fa-md fa-desktop"></i></div>
        <div class="mobile-nav-label">VPS</div>
      <% end %>
      <a href="#" class="mobile-nav-item" onclick="toggleMobileSidebar(); return false;">
        <div class="mobile-nav-icon"><i class="fa-icon fa-md fa-bars"></i></div>
        <div class="mobile-nav-label">Menu</div>
      </a>
    </div>
  </div>
<% else %>
  <!-- Mobile bottom navigation for admins -->
  <div class="mobile-bottom-nav">
    <div class="mobile-bottom-nav-content">
      <%= link_to admin_clients_path, class: "mobile-nav-item #{request.path == admin_clients_path ? 'active' : ''}" do %>
        <div class="mobile-nav-icon"><i class="fa-icon fa-md fa-users"></i></div>
        <div class="mobile-nav-label">Clients</div>
      <% end %>
      <%= link_to admin_bots_path, class: "mobile-nav-item #{request.path.start_with?('/admin/bots') ? 'active' : ''}" do %>
        <div class="mobile-nav-icon"><i class="fa-icon fa-md fa-robot"></i></div>
        <div class="mobile-nav-label">Bots</div>
      <% end %>
      <%= link_to admin_payments_path, class: "mobile-nav-item #{request.path == admin_payments_path ? 'active' : ''}" do %>
        <div class="mobile-nav-icon"><i class="fa-icon fa-md fa-credit-card"></i></div>
        <div class="mobile-nav-label">Paiements</div>
      <% end %>
      <%= link_to admin_shop_index_path, class: "mobile-nav-item #{request.path.start_with?('/admin/shop') ? 'active' : ''}" do %>
        <div class="mobile-nav-icon"><i class="fa-icon fa-md fa-shopping-cart"></i></div>
        <div class="mobile-nav-label">Boutique</div>
      <% end %>
      <a href="#" class="mobile-nav-item" onclick="toggleMobileSidebar(); return false;">
        <div class="mobile-nav-icon"><i class="fa-icon fa-md fa-bars"></i></div>
        <div class="mobile-nav-label">Plus</div>
      </a>
    </div>
  </div>
<% end %>

<script>
  function toggleSidebarCollapse() {
    const sidebar = document.getElementById('mainSidebar');
    const toggleBtn = document.getElementById('sidebarToggleBtn');
    const isCollapsed = sidebar.classList.toggle('collapsed');
    
    toggleBtn.innerHTML = isCollapsed ? '<i class="fa-solid fa-chevron-right"></i>' : '<i class="fa-solid fa-chevron-left"></i>';
    toggleBtn.title = isCollapsed ? 'Agrandir la barre latérale' : 'Réduire la barre latérale';
    
    localStorage.setItem('sidebarCollapsed', isCollapsed ? 'true' : 'false');
    document.documentElement.classList.toggle('sidebar-collapsed-init', isCollapsed);
  }
  
  function toggleMobileSidebar() {
    const sidebar = document.getElementById('mainSidebar');
    const overlay = document.getElementById('sidebarOverlay');
    sidebar.classList.toggle('open');
    overlay.classList.toggle('active');
    document.body.style.overflow = sidebar.classList.contains('open') ? 'hidden' : '';
  }

  function openUserSettings() {
    // Pour l'instant, rediriger vers le profil utilisateur
    // Plus tard, on pourra implémenter une modal de paramètres
    window.location.href = '<%= admin_client_path(current_user) %>';
  }

  (function() {
    console.log('=== SIDEBAR JAVASCRIPT DEBUG ===');
    const sidebar = document.getElementById('mainSidebar');
    const toggleBtn = document.getElementById('sidebarToggleBtn');
    const isCollapsed = localStorage.getItem('sidebarCollapsed') === 'true';
    
    console.log('Sidebar element:', sidebar);
    console.log('Toggle button:', toggleBtn);
    console.log('Is collapsed:', isCollapsed);
    
    // Debug: Check for FontAwesome icons
    const icons = document.querySelectorAll('.sidebar-menu-icon');
    console.log('Found sidebar icons:', icons.length);
    icons.forEach((icon, index) => {
      console.log(`Icon ${index}:`, icon);
      console.log(`Icon classes:`, icon.className);
      const style = window.getComputedStyle(icon);
      console.log(`Icon computed style:`, style);
      console.log(`Font family:`, style.fontFamily);
      console.log(`Font weight:`, style.fontWeight);
      console.log(`Display:`, style.display);
      console.log(`Visibility:`, style.visibility);
      console.log(`Opacity:`, style.opacity);
      console.log(`Color:`, style.color);
      
      // Check if icon has content
      console.log(`Icon text content:`, icon.textContent);
      console.log(`Icon innerHTML:`, icon.innerHTML);
    });
    
    // Debug: Check for any FontAwesome icons in sidebar
    const allFaSolid = document.querySelectorAll('.sidebar .fa-solid');
    console.log('Found all .fa-solid in sidebar:', allFaSolid.length);
    allFaSolid.forEach((icon, index) => {
      console.log(`FA Solid ${index}:`, icon);
      console.log(`Classes:`, icon.className);
      const style = window.getComputedStyle(icon);
      console.log(`Font family:`, style.fontFamily);
      console.log(`Display:`, style.display);
    });
    
    if (isCollapsed && sidebar && toggleBtn && window.innerWidth > 768) {
      sidebar.classList.add('collapsed');
      toggleBtn.innerHTML = '<i class="fa-solid fa-chevron-right"></i>';
      toggleBtn.title = 'Agrandir la barre latérale';
    }
    console.log('=== END SIDEBAR JAVASCRIPT DEBUG ===');
  })();
</script>

