<% @page_title = "Mises à jour - #{@bot.name}" %>

<div class="space-y-6">
  <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
    <div class="flex items-center gap-4">
      <%= link_to admin_bot_path(@bot), class: "flex items-center justify-center w-10 h-10 rounded-lg border border-neutral-800 bg-neutral-900 text-neutral-400 hover:bg-neutral-800 hover:text-white transition-colors" do %>
        <i class="fa-solid fa-arrow-left"></i>
      <% end %>
      
      <div class="flex items-center gap-4">
        <div class="w-14 h-14 rounded-xl bg-gradient-to-br from-orange-500 to-red-600 flex items-center justify-center text-white shadow-lg shadow-orange-500/20">
          <i class="fa-solid fa-arrow-up-from-bracket text-2xl"></i>
        </div>
        <div>
          <h1 class="text-2xl font-bold text-white">Mises à jour</h1>
          <p class="text-neutral-400"><%= @bot.name %> - v<%= @bot.current_version %></p>
        </div>
      </div>
    </div>
    
    <% if current_user.is_admin? %>
      <%= link_to new_admin_bot_bot_update_path(@bot), class: "inline-flex items-center justify-center gap-2 rounded-lg bg-gradient-to-r from-orange-500 to-red-600 px-5 py-2.5 text-sm font-medium text-white shadow-lg shadow-orange-600/25 transition-all hover:shadow-orange-500/40 hover:scale-[1.02]" do %>
        <i class="fa-solid fa-plus"></i>
        Nouvelle Mise à Jour
      <% end %>
    <% end %>
  </div>

  <% if flash[:notice] %>
    <div class="flex items-center gap-3 p-4 rounded-xl border border-green-500/20 bg-green-500/10">
      <i class="fa-solid fa-check-circle text-green-400"></i>
      <p class="text-green-300"><%= flash[:notice] %></p>
    </div>
  <% end %>

  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
    <div class="bg-neutral-900 overflow-hidden rounded-xl">
      <div class="px-5 py-4">
        <div class="flex items-center gap-3">
          <div class="w-10 h-10 rounded-lg bg-blue-500/10 flex items-center justify-center">
            <i class="fa-solid fa-code-branch text-blue-400"></i>
          </div>
          <div>
            <p class="text-sm text-neutral-400">Version actuelle</p>
            <p class="text-2xl font-bold text-white">v<%= @bot.current_version %></p>
          </div>
        </div>
      </div>
    </div>
    
    <div class="bg-neutral-900 overflow-hidden rounded-xl">
      <div class="px-5 py-4">
        <div class="flex items-center gap-3">
          <div class="w-10 h-10 rounded-lg bg-orange-500/10 flex items-center justify-center">
            <i class="fa-solid fa-users text-orange-400"></i>
          </div>
          <div>
            <p class="text-sm text-neutral-400">Clients à mettre à jour</p>
            <p class="text-2xl font-bold text-orange-400"><%= @users_needing_update.count %></p>
          </div>
        </div>
      </div>
    </div>
    
    <div class="bg-neutral-900 overflow-hidden rounded-xl">
      <div class="px-5 py-4">
        <div class="flex items-center gap-3">
          <div class="w-10 h-10 rounded-lg bg-emerald-500/10 flex items-center justify-center">
            <i class="fa-solid fa-euro-sign text-emerald-400"></i>
          </div>
          <div>
            <p class="text-sm text-neutral-400">Revenus mises à jour</p>
            <p class="text-2xl font-bold text-emerald-400"><%= number_to_currency(@update_revenue, unit: "€", format: "%n%u") %></p>
          </div>
        </div>
      </div>
    </div>
    
    <div class="bg-neutral-900 overflow-hidden rounded-xl">
      <div class="px-5 py-4">
        <div class="flex items-center gap-3">
          <div class="w-10 h-10 rounded-lg bg-purple-500/10 flex items-center justify-center">
            <i class="fa-solid fa-gem text-purple-400"></i>
          </div>
          <div>
            <p class="text-sm text-neutral-400">Prix mise à jour</p>
            <p class="text-2xl font-bold text-purple-400"><%= number_to_currency(@bot.update_price, unit: "€", format: "%n%u") %></p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <% if @users_needing_update.any? %>
    <div class="bg-gradient-to-r from-orange-500/10 to-red-500/10 border border-orange-500/30 rounded-xl p-6">
      <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
        <div class="flex items-start gap-4">
          <div class="w-12 h-12 rounded-xl bg-orange-500/20 flex items-center justify-center text-orange-400">
            <i class="fa-solid fa-bell text-xl"></i>
          </div>
          <div>
            <h3 class="text-lg font-bold text-white"><%= @users_needing_update.count %> clients ont une version obsolète</h3>
            <p class="text-neutral-300 text-sm mt-1">
              Ces clients utilisent une ancienne version et pourraient bénéficier de la mise à jour.
              <span class="text-orange-400 font-medium">Revenu potentiel: <%= number_to_currency(@users_needing_update.count * @bot.update_price, unit: "€", format: "%n%u") %></span>
            </p>
          </div>
        </div>
        <% if @updates.any? %>
          <%= button_to notify_users_admin_bot_bot_update_path(@bot, @updates.first), method: :post, class: "shrink-0 inline-flex items-center justify-center gap-2 rounded-lg bg-orange-500 px-5 py-2.5 text-sm font-medium text-white shadow-lg shadow-orange-500/25 transition-all hover:bg-orange-400" do %>
            <i class="fa-solid fa-paper-plane"></i>
            Notifier les clients
          <% end %>
        <% end %>
      </div>
    </div>
  <% end %>

  <% if @updates.any? %>
    <div class="space-y-4">
      <% @updates.each do |update| %>
        <div class="bg-neutral-950 border border-neutral-800 rounded-xl overflow-hidden hover:border-neutral-700 transition-colors">
          <div class="flex flex-col lg:flex-row">
            <div class="flex-1 p-6">
              <div class="flex items-start gap-4">
                <div class="w-12 h-12 rounded-xl flex items-center justify-center text-white shadow-lg <%= update.is_major? ? 'bg-gradient-to-br from-orange-500 to-red-600 shadow-orange-500/20' : 'bg-gradient-to-br from-blue-500 to-cyan-600 shadow-blue-500/20' %>">
                  <i class="fa-solid <%= update.is_major? ? 'fa-star' : 'fa-code-merge' %> text-xl"></i>
                </div>
                <div class="flex-1">
                  <div class="flex items-center gap-3 flex-wrap">
                    <h3 class="text-lg font-bold text-white"><%= update.title %></h3>
                    <span class="inline-flex items-center rounded-full px-2.5 py-1 text-xs font-semibold bg-blue-400/10 text-blue-400 ring-1 ring-inset ring-blue-400/25">
                      v<%= update.version %>
                    </span>
                    <% if update.is_major? %>
                      <span class="inline-flex items-center rounded-full px-2.5 py-1 text-xs font-semibold bg-orange-400/10 text-orange-400 ring-1 ring-inset ring-orange-400/25">
                        <i class="fa-solid fa-fire mr-1"></i> MAJEURE
                      </span>
                    <% end %>
                    <% if update.is_free? %>
                      <span class="inline-flex items-center rounded-full px-2.5 py-1 text-xs font-semibold bg-green-400/10 text-green-400 ring-1 ring-inset ring-green-400/25">
                        <i class="fa-solid fa-gift mr-1"></i> GRATUIT
                      </span>
                    <% end %>
                  </div>
                  
                  <% if update.description.present? %>
                    <p class="text-neutral-400 text-sm mt-2"><%= update.description %></p>
                  <% end %>
                  
                  <% if update.highlights_list.any? %>
                    <div class="mt-4 flex flex-wrap gap-2">
                      <% update.highlights_list.first(3).each do |highlight| %>
                        <span class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-neutral-800 text-sm text-neutral-300">
                          <i class="fa-solid fa-check text-green-400 text-xs"></i>
                          <%= highlight %>
                        </span>
                      <% end %>
                    </div>
                  <% end %>
                  
                  <div class="flex items-center gap-4 mt-4 text-sm text-neutral-500">
                    <span class="flex items-center gap-1.5">
                      <i class="fa-solid fa-calendar"></i>
                      <%= update.released_at.strftime("%d/%m/%Y") %>
                    </span>
                    <span class="flex items-center gap-1.5">
                      <i class="fa-solid fa-download"></i>
                      <%= update.upgrade_count %> upgrades
                    </span>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="lg:w-56 flex lg:flex-col items-center justify-end gap-2 p-6 lg:border-l border-t lg:border-t-0 border-neutral-800 bg-neutral-900/50">
              <% if current_user.is_admin? %>
                <%= link_to admin_bot_bot_update_path(@bot, update), class: "flex-1 lg:w-full flex items-center justify-center gap-1.5 rounded-lg border border-neutral-700 bg-neutral-800 px-3 py-2 text-sm font-medium text-neutral-100 transition-all hover:bg-neutral-700" do %>
                  <i class="fa-solid fa-eye text-xs"></i>
                  Voir
                <% end %>
                <%= link_to edit_admin_bot_bot_update_path(@bot, update), class: "flex-1 lg:w-full flex items-center justify-center gap-1.5 rounded-lg border border-amber-400/30 bg-amber-500 px-3 py-2 text-sm font-medium text-white transition-all hover:bg-amber-400" do %>
                  <i class="fa-solid fa-pen text-xs"></i>
                  Modifier
                <% end %>
              <% end %>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  <% else %>
    <div class="bg-neutral-950 rounded-xl overflow-hidden">
      <div class="text-center py-16 px-6">
        <div class="w-20 h-20 mx-auto mb-6 rounded-2xl bg-gradient-to-br from-orange-500/20 to-red-500/20 flex items-center justify-center">
          <i class="fa-solid fa-arrow-up-from-bracket text-4xl text-orange-400"></i>
        </div>
        <h3 class="text-xl font-bold text-white mb-2">Aucune mise à jour publiée</h3>
        <p class="text-neutral-400 mb-8 max-w-md mx-auto">Créez votre première mise à jour pour notifier vos clients et générer des revenus supplémentaires.</p>
        <%= link_to new_admin_bot_bot_update_path(@bot), class: "inline-flex items-center justify-center gap-2 rounded-lg bg-gradient-to-r from-orange-500 to-red-600 px-6 py-3 text-sm font-medium text-white shadow-lg shadow-orange-600/25 transition-all hover:shadow-orange-500/40 hover:scale-[1.02]" do %>
          <i class="fa-solid fa-plus"></i>
          Créer la première mise à jour
        <% end %>
      </div>
    </div>
  <% end %>
</div>

